const CACHE_VERSION="v3.1.1",CACHE_NAME="cerita-cache-v3.1.1",BASE_PATH="/cerita_masyarakat-akhir/";self.skipWaiting();const ASSETS_TO_CACHE=[`${BASE_PATH}`,`${BASE_PATH}index.html`,`${BASE_PATH}offline.html`,`${BASE_PATH}app.bundle.js`,`${BASE_PATH}app.css`,`${BASE_PATH}manifest.json`,`${BASE_PATH}images/icon-192.png`,`${BASE_PATH}images/icon-512.png`,`${BASE_PATH}images/logo.png`];let userToken=null;self.addEventListener("message",(e=>{"SET_TOKEN"===e.data?.type&&(userToken=e.data.token,console.log("ðŸ”‘ Token disimpan di Service Worker:",userToken))})),self.addEventListener("install",(e=>{console.log("âœ… Service Worker: Installed"),e.waitUntil(caches.open(CACHE_NAME).then((e=>e.addAll(ASSETS_TO_CACHE))))})),self.addEventListener("activate",(e=>{console.log("âš¡ Service Worker: Activated"),e.waitUntil(caches.keys().then((e=>Promise.all(e.filter((e=>e!==CACHE_NAME)).map((e=>caches.delete(e)))))).then((()=>self.clients.claim())))})),self.addEventListener("fetch",(e=>{if("GET"!==e.request.method)return;const t=e.request,a=new URL(t.url),i=a.origin.includes("story-api.dicoding.dev");a.protocol.startsWith("chrome-extension")||e.respondWith((async()=>{const e=await caches.open(CACHE_NAME);try{const a=await fetch(t),i=a.clone();return e.put(t,i),a}catch(a){const n=await e.match(t);return n||(i?(console.warn("âš ï¸ Offline mode, data API tidak tersedia"),new Response(JSON.stringify({error:!0,message:"Offline â€“ data tidak tersedia"}),{headers:{"Content-Type":"application/json"}})):await e.match(`${BASE_PATH}offline.html`)||await e.match("/offline.html")||await e.match("./offline.html")||await e.match(`${self.location.origin}${BASE_PATH}offline.html`)||new Response("Anda sedang offline.",{status:503}))}})())})),self.addEventListener("push",(e=>{let t={};try{t=e.data?e.data.json():{}}catch{t={title:"Notifikasi",body:e.data.text()}}const a=t.title||"Notifikasi Baru!",i={body:t.body||"Ada pembaruan dari Cerita Masyarakat.",icon:`${BASE_PATH}images/icon-192.png`,badge:`${BASE_PATH}images/icon-192.png`,data:{url:t.url||BASE_PATH},actions:[{action:"open_url",title:"Lihat Detail"}]};e.waitUntil(self.registration.showNotification(a,i))})),self.addEventListener("notificationclick",(e=>{e.notification.close();const t=e.notification?.data?.url||BASE_PATH;"open_url"!==e.action&&""!==e.action||e.waitUntil(clients.openWindow(t))}));