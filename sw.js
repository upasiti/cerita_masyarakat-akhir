const CACHE_VERSION="v3.3.0",CACHE_NAME="cerita-cache-v3.3.0",BASE_PATH="/cerita_masyarakat-akhir/";self.skipWaiting();const ASSETS_TO_CACHE=[`${BASE_PATH}`,`${BASE_PATH}index.html`,`${BASE_PATH}offline.html`,`${BASE_PATH}app.bundle.js`,`${BASE_PATH}app.css`,`${BASE_PATH}manifest.json`,`${BASE_PATH}images/icon-192.png`,`${BASE_PATH}images/icon-512.png`,`${BASE_PATH}images/logo.png`];self.addEventListener("install",(e=>{console.log("âœ… Service Worker: Installed"),e.waitUntil(caches.open(CACHE_NAME).then((e=>(console.log("ğŸ“¦ Menyimpan asset ke cache:",ASSETS_TO_CACHE),e.addAll(ASSETS_TO_CACHE)))).catch((e=>console.error("âŒ Gagal cache asset:",e))))})),self.addEventListener("activate",(e=>{console.log("âš¡ Service Worker: Activated"),e.waitUntil(caches.keys().then((e=>Promise.all(e.filter((e=>e!==CACHE_NAME)).map((e=>caches.delete(e)))))).then((()=>self.clients.claim())))})),self.addEventListener("fetch",(e=>{if("GET"!==e.request.method)return;const n=e.request,a=new URL(n.url),t=a.origin.includes("story-api.dicoding.dev");a.protocol.startsWith("chrome-extension")||e.respondWith((async()=>{const e=await caches.open(CACHE_NAME);try{const a=await fetch(n);return a&&404!==a.status?(e.put(n,a.clone()),a):(console.warn("âš ï¸ Fetch 404:",n.url),await e.match(`${BASE_PATH}offline.html`)||new Response("Anda sedang offline.",{status:503}))}catch(a){console.warn("âš ï¸ Fetch gagal (offline):",n.url,a);const s=await e.match(n);if(s)return console.log("ğŸ“¦ Menggunakan cache untuk:",n.url),s;if(t)return console.warn("âš ï¸ Offline, API tidak tersedia"),new Response(JSON.stringify({error:!0,message:"Offline â€“ data tidak tersedia"}),{headers:{"Content-Type":"application/json"}});if("navigate"===n.mode||"document"===n.destination){const n=await e.match(`${BASE_PATH}offline.html`);return console.log("ğŸ§± Menampilkan offline.html karena gagal navigate"),n||new Response("Anda sedang offline.",{status:503})}const o=await e.match(`${BASE_PATH}offline.html`);return console.log("ğŸ§± Menggunakan fallback offline.html:",!!o),o||new Response("Anda sedang offline.",{status:503})}})())}));