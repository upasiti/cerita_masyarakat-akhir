const CACHE_VERSION="v4.0.0",ORIGIN=self.location.origin,BASE_PATH=self.location.pathname.includes("/cerita_masyarakat-akhir/")?"/cerita_masyarakat-akhir/":"/",CACHE_NAME="cerita-cache-v4.0.0";self.skipWaiting();const ASSETS_TO_CACHE=[`${BASE_PATH}`,`${BASE_PATH}index.html`,`${BASE_PATH}offline.html`,`${BASE_PATH}app.bundle.js`,`${BASE_PATH}app.css`,`${BASE_PATH}manifest.json`,`${BASE_PATH}images/icon-192.png`,`${BASE_PATH}images/icon-512.png`,`${BASE_PATH}images/logo.png`];self.addEventListener("install",(e=>{console.log("âœ… Service Worker: Installed"),e.waitUntil(caches.open(CACHE_NAME).then((e=>(console.log("ðŸ“¦ Caching assets:",ASSETS_TO_CACHE),e.addAll(ASSETS_TO_CACHE)))))})),self.addEventListener("activate",(e=>{console.log("âš¡ Service Worker: Activated"),e.waitUntil(caches.keys().then((e=>Promise.all(e.filter((e=>e!==CACHE_NAME)).map((e=>caches.delete(e)))))).then((()=>self.clients.claim())))})),self.addEventListener("fetch",(e=>{if("GET"!==e.request.method)return;const t=e.request;new URL(t.url).protocol.startsWith("chrome-extension")||e.respondWith((async()=>{const e=await caches.open(CACHE_NAME);try{const n=await fetch(t);return n&&404!==n.status?(e.put(t,n.clone()),n):(console.warn("âš ï¸ Fetch 404:",t.url),await e.match(`${BASE_PATH}offline.html`)||new Response("Anda sedang offline.",{status:503}))}catch(n){console.warn("âš ï¸ Offline:",t.url,n);const a=await e.match(t);return a||("navigate"===t.mode||t.destination,await e.match(`${BASE_PATH}offline.html`)||new Response("Anda sedang offline.",{status:503}))}})())})),self.addEventListener("push",(e=>{console.log("ðŸ“© Push diterima:",e);let t={};try{t=e.data.json()}catch(n){t={title:e.data.text()||"Notifikasi Baru",body:""}}const n=t.title||"Notifikasi Baru",a={body:t.body||"Ada pembaruan di aplikasi!",icon:"/images/icon-192.png",badge:"/images/icon-192.png"};e.waitUntil(self.registration.showNotification(n,a))})),self.addEventListener("notificationclick",(e=>{e.notification.close();const t=e.notification.data.url||`${BASE_PATH}#/`;e.waitUntil(clients.matchAll({type:"window"}).then((e=>{for(const t of e)if(t.url.includes(BASE_PATH))return t.focus();return clients.openWindow(t)})))}));