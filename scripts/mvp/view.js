export default class StoryView{bindElements(){this.loadingElement=document.getElementById("loading"),this.container=document.getElementById("stories-container"),this.modal=document.getElementById("detailModal"),this.modalContent=document.getElementById("modal-content"),this.closeBtn=document.getElementById("closeModal")}showLoading(){this.loadingElement&&(this.loadingElement.style.display="block")}hideLoading(){this.loadingElement&&(this.loadingElement.style.display="none")}displayStories(t){this.container&&(t.length?(this.container.innerHTML=t.map((t=>`\n      <article class="story-card" tabindex="0" data-id="${t.id}">\n        <img \n          src="${t.photoUrl}" \n          alt="Gambar cerita ${t.name}" \n          class="story-image" \n          loading="lazy"\n        />\n        <h3 class="story-name">${t.name}</h3>\n        <p class="story-description">${t.description}</p>\n        <p class="story-date">${new Date(t.createdAt).toLocaleString("id-ID")}</p>\n        <div class="story-actions">\n          <button class="detail-button" data-id="${t.id}" aria-label="Lihat detail cerita ${t.name}">\n            ğŸ“– Lihat Detail\n          </button>\n          <button class="save-fav" data-id="${t.id}" aria-label="Simpan cerita ${t.name}">\n            ğŸ’¾ Simpan Story\n          </button>\n        </div>\n      </article>\n    `)).join(""),this.bindSaveFavorite(t)):this.container.innerHTML='\n        <p class="no-stories" tabindex="0">Tidak ada cerita yang tersedia.</p>\n      ')}bindAddStoryForm(t){const e=document.querySelector("#addStoryForm");e&&e.addEventListener("submit",(n=>{n.preventDefault();const a=new FormData(e);t(a)}))}bindDetailButton(t,e){const n=document.getElementById("detailModal"),a=document.getElementById("modal-content"),o=document.getElementById("closeModal");n&&a?(document.querySelectorAll(".detail-button").forEach((e=>{e.addEventListener("click",(()=>{const o=e.dataset.id,d=t.find((t=>t.id===o));if(!d)return;a.innerHTML=`\n          <div class="modal-content-wrapper">\n            <span id="closeModalInner" class="close-button">&times;</span>\n            <img src="${d.photoUrl}" alt="${d.name}" class="modal-image" />\n            <h3>${d.name}</h3>\n            <p class="modal-description">${d.description}</p>\n            ${d.lat&&d.lon?`<button \n                    id="focusMapBtn" \n                    class="focus-map-btn" \n                    data-lat="${d.lat}" \n                    data-lon="${d.lon}">\n                    ğŸ“ Lihat Lokasi di Peta\n                   </button>`:"<p><em>Tidak ada lokasi</em></p>"}\n          </div>\n        `,n.style.display="flex",document.body.style.overflow="hidden";const i=document.getElementById("closeModalInner");i&&i.addEventListener("click",(()=>this.hideModal()));const s=document.getElementById("focusMapBtn");s&&s.addEventListener("click",(()=>{const t=parseFloat(s.dataset.lat),e=parseFloat(s.dataset.lon);this.hideModal();const n=`https://www.google.com/maps?q=${t},${e}`;window.open(n,"_blank")}))}))})),o&&o.addEventListener("click",(()=>this.hideModal())),window.addEventListener("click",(t=>{t.target===n&&this.hideModal()}))):console.warn("âš ï¸ Elemen modal belum ditemukan di DOM.")}bindSaveFavorite(t){document.querySelectorAll(".save-fav").forEach((e=>{e.addEventListener("click",(async()=>{const n=e.dataset.id,a=t.find((t=>t.id===n));if(!a)return;const o="favorites";await(async t=>{const e=(await new Promise(((t,e)=>{const n=indexedDB.open("story-favorites-db",1);n.onupgradeneeded=t=>{const e=t.target.result;e.objectStoreNames.contains(o)||e.createObjectStore(o,{keyPath:"id"})},n.onsuccess=e=>t(e.target.result),n.onerror=t=>e(t.target.error)}))).transaction(o,"readwrite");return e.objectStore(o).put(t),new Promise((t=>{e.oncomplete=()=>t(!0)}))})(a),alert("âœ… Cerita disimpan ke favorit!")}))}))}hideModal(){const t=document.getElementById("detailModal");t&&(t.style.display="none"),document.body.style.overflow="auto"}}