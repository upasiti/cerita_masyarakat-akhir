import StoryModel from"../../mvp/model.js";import StoryView from"../../mvp/view.js";import StoryPresenter from"../../mvp/presenter.js";export default class HomePage{constructor(){this.model=new StoryModel,this.view=new StoryView,this.presenter=new StoryPresenter(this.model,this.view)}async render(){return'\n    <section class="container">\n      <a href="#main-content" class="skip-link">Skip to content</a>\n      <h1 tabindex="0">Cerita Masyarakat</h1>\n      <div id="loading" class="loading" aria-live="polite" style="display: none;">Memuat data...</div>\n      \n      <div class="content-layout">\n        <aside class="stories-sidebar" aria-label="Daftar cerita pengguna">\n          <h2 tabindex="0">Daftar Cerita</h2>\n          <div id="stories-container" class="stories-container"></div>\n        </aside>\n        \n        <main class="map-container" aria-label="Peta lokasi cerita">\n          <h2 tabindex="0">Peta Lokasi</h2>\n          <div id="map" class="map"></div>\n        </main>\n      </div>\n\n      <div id="detailModal" class="modal" role="dialog" aria-modal="true" style="display:none;">\n        <div class="modal-content-wrapper">\n          <span id="closeModal" class="close-button" aria-label="Tutup popup">&times;</span>\n          <div id="modal-content"></div>\n        </div>\n      </div>\n\n      <div class="floating-action">\n        <a href="#/add-story" class="fab" aria-label="Tambah cerita baru">+</a>\n      </div>\n    </section>\n  '}async afterRender(){await this.loadLeaflet(),this.view.bindElements(),await this.presenter.init(),setTimeout((()=>{document.querySelectorAll(".detail-button").length>0&&this.presenter.stories?.length?this.view.bindDetailButton(this.presenter.stories,((e,t)=>{if(this.presenter.map&&e&&t){this.presenter.map.setView([e,t],14);const a=this.presenter.markers.find((a=>a.getLatLng().lat===e&&a.getLatLng().lng===t));a&&a.openPopup()}})):console.warn("⚠️ Tidak ditemukan tombol detail di DOM.")}),500),this.setupInteractions()}loadLeaflet(){return new Promise((e=>{const t=document.createElement("link");t.rel="stylesheet",t.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(t);const a=document.createElement("script");a.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",a.onload=e,document.head.appendChild(a)}))}setupInteractions(){document.addEventListener("mouseover",(e=>{if(e.target.closest(".story-card")){const t=e.target.closest(".story-card").dataset.id,a=this.presenter.markers.find((e=>e._popup&&e._popup._content.includes(`"${t}"`)));a&&a.openPopup()}}))}}