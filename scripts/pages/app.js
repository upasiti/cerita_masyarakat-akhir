import routes,{checkAuth}from"../routes/routes";import{getActiveRoute}from"../routes/url-parser";import{transitionTo}from"../utils/transitions.js";class App{#t=null;#e=null;#n=null;constructor({navigationDrawer:t,drawerButton:e,content:n}){this.#t=n,this.#e=e,this.#n=t,this._setupDrawer(),this._setupAccessibility(),this._updateAuthNav()}_setupDrawer(){this.#e.addEventListener("click",(()=>{this.#n.classList.toggle("open")})),this.#e.addEventListener("keydown",(t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),this.#n.classList.toggle("open"))})),document.body.addEventListener("click",(t=>{this.#n.contains(t.target)||this.#e.contains(t.target)||this.#n.classList.remove("open"),this.#n.querySelectorAll("a").forEach((e=>{e.contains(t.target)&&this.#n.classList.remove("open")}))}))}_setupAccessibility(){const t=document.querySelector(".skip-link");t&&t.addEventListener("click",(t=>{t.preventDefault();const e=document.querySelector("#main-content");e.setAttribute("tabindex","-1"),e.focus()})),this.#n.addEventListener("keydown",(t=>{"Escape"===t.key&&(this.#n.classList.remove("open"),this.#e.focus())}))}async renderPage(){const t=getActiveRoute(),e=routes[t];if((!["/add-story","/favorite"].includes(t)||checkAuth())&&e){document.startViewTransition?document.startViewTransition((async()=>{this.#t.innerHTML=await e.render(),await e.afterRender()})):await transitionTo((async()=>{this.#t.innerHTML=await e.render(),await e.afterRender()}),this.#t);const t=this.#t.querySelector("h1");t&&t.hasAttribute("tabindex")&&t.focus(),this._updateAuthNav()}}_updateAuthNav(){const t=document.querySelector("#nav-auth");t&&(checkAuth()?(t.innerHTML='<button id="logout-btn" class="logout-btn">Logout</button>',document.querySelector("#logout-btn").addEventListener("click",(()=>{localStorage.removeItem("token"),window.location.hash="#/login",this._updateAuthNav()}))):t.innerHTML='<a href="#/login">Login</a>')}}export default App;