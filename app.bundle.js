/*! For license information please see app.bundle.js.LICENSE.txt */
(()=>{var t={897:()=>{function t(){var n,r,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function c(t,o,i,a){var c=o&&o.prototype instanceof s?o:s,l=Object.create(c.prototype);return e(l,"_invoke",function(t,e,o){var i,a,c,s=0,l=o||[],f=!1,p={p:0,n:0,v:n,a:d,f:d.bind(n,4),d:function(t,e){return i=t,a=0,c=n,p.n=e,u}};function d(t,e){for(a=t,c=e,r=0;!f&&s&&!o&&r<l.length;r++){var o,i=l[r],d=p.p,v=i[2];t>3?(o=v===e)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=n):i[0]<=d&&((o=t<2&&d<i[1])?(a=0,p.v=e,p.n=i[1]):d<v&&(o=t<3||i[0]>e||e>v)&&(i[4]=t,i[5]=e,p.n=v,a=0))}if(o||t>1)return u;throw f=!0,e}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),a=l,c=v;(r=a<2?n:c)||!f;){i||(a?a<3?(a>1&&(p.n=-1),d(a,c)):p.n=c:p.v=c);try{if(s=2,i){if(a||(o="next"),r=i[o]){if(!(r=r.call(i,c)))throw TypeError("iterator result is not an object");if(!r.done)return r;c=r.value,a<2&&(a=0)}else 1===a&&(r=i.return)&&r.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=n}else if((r=(f=p.n<0)?c:t.call(e,p))!==u)break}catch(t){i=n,a=1,c=t}finally{s=1}}return{value:r,done:f}}}(t,i,a),!0),l}var u={};function s(){}function l(){}function f(){}r=Object.getPrototypeOf;var p=[][i]?r(r([][i]())):(e(r={},i,(function(){return this})),r),d=f.prototype=s.prototype=Object.create(p);function v(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,e(t,a,"GeneratorFunction")),t.prototype=Object.create(d),t}return l.prototype=f,e(d,"constructor",f),e(f,"constructor",l),l.displayName="GeneratorFunction",e(f,a,"GeneratorFunction"),e(d),e(d,a,"Generator"),e(d,i,(function(){return this})),e(d,"toString",(function(){return"[object Generator]"})),(t=function(){return{w:c,m:v}})()}function e(t,n,r,o){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}e=function(t,n,r,o){function a(n,r){e(t,n,(function(t){return this._invoke(n,r,t)}))}n?i?i(t,n,{value:r,enumerable:!o,configurable:!o,writable:!o}):t[n]=r:(a("next",0),a("throw",1),a("return",2))},e(t,n,r,o)}function n(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function r(t){return function(){var e=this,r=arguments;return new Promise((function(o,i){var a=t.apply(e,r);function c(t){n(a,o,i,c,u,"next",t)}function u(t){n(a,o,i,c,u,"throw",t)}c(void 0)}))}}var o=document.getElementById("push-toggle"),i=!1;function a(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),o=0;o<n.length;++o)r[o]=n.charCodeAt(o);return r}function c(){return u.apply(this,arguments)}function u(){return(u=r(t().m((function e(){var n,r,o,c;return t().w((function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,navigator.serviceWorker.ready;case 1:return n=t.v,r=a("BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk"),t.n=2,n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:r});case 2:o=t.v,console.log("‚úÖ Push Subscription berhasil dibuat:",o),alert("Notifikasi berhasil diaktifkan!"),i=!0,f(),t.n=4;break;case 3:t.p=3,c=t.v,console.error("üö´ Gagal membuat Push Subscription:",c);case 4:return t.a(2)}}),e,null,[[0,3]])})))).apply(this,arguments)}function s(){return l.apply(this,arguments)}function l(){return(l=r(t().m((function e(){var n,r;return t().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,navigator.serviceWorker.ready;case 1:return n=t.v,t.n=2,n.pushManager.getSubscription();case 2:if(!(r=t.v)){t.n=4;break}return t.n=3,r.unsubscribe();case 3:console.log("üö´ Berhenti langganan notifikasi"),alert("Notifikasi dimatikan.");case 4:i=!1,f();case 5:return t.a(2)}}),e)})))).apply(this,arguments)}function f(){i?(o.textContent="üö´ Nonaktifkan Notifikasi",o.classList.add("active")):(o.textContent="üîî Aktifkan Notifikasi",o.classList.remove("active"))}o.addEventListener("click",r(t().m((function e(){return t().w((function(t){for(;;)switch(t.n){case 0:if("denied"!==Notification.permission){t.n=1;break}return alert("Izin notifikasi ditolak, aktifkan dari pengaturan browser."),t.a(2);case 1:if(!i){t.n=3;break}return t.n=2,s();case 2:t.n=5;break;case 3:return t.n=4,Notification.requestPermission();case 4:if("granted"!==t.v){t.n=5;break}return t.n=5,c();case 5:return t.a(2)}}),e)})))),navigator.serviceWorker.ready.then(function(){var e=r(t().m((function e(n){var r;return t().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,n.pushManager.getSubscription();case 1:r=t.v,i=!!r,f();case 2:return t.a(2)}}),e)})));return function(t){return e.apply(this,arguments)}}())}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}(()=>{"use strict";const t="https://story-api.dicoding.dev/v1";function e(){var t,n,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function c(e,o,i,a){var c=o&&o.prototype instanceof s?o:s,l=Object.create(c.prototype);return r(l,"_invoke",function(e,r,o){var i,a,c,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,a=0,c=t,p.n=n,u}};function d(e,r){for(a=e,c=r,n=0;!f&&s&&!o&&n<l.length;n++){var o,i=l[n],d=p.p,v=i[2];e>3?(o=v===r)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=e<2&&d<i[1])?(a=0,p.v=r,p.n=i[1]):d<v&&(o=e<3||i[0]>r||r>v)&&(i[4]=e,i[5]=r,p.n=v,a=0))}if(o||e>1)return u;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),a=l,c=v;(n=a<2?t:c)||!f;){i||(a?a<3?(a>1&&(p.n=-1),d(a,c)):p.n=c:p.v=c);try{if(s=2,i){if(a||(o="next"),n=i[o]){if(!(n=n.call(i,c)))throw TypeError("iterator result is not an object");if(!n.done)return n;c=n.value,a<2&&(a=0)}else 1===a&&(n=i.return)&&n.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=t}else if((n=(f=p.n<0)?c:e.call(r,p))!==u)break}catch(e){i=t,a=1,c=e}finally{s=1}}return{value:n,done:f}}}(e,i,a),!0),l}var u={};function s(){}function l(){}function f(){}n=Object.getPrototypeOf;var p=[][i]?n(n([][i]())):(r(n={},i,(function(){return this})),n),d=f.prototype=s.prototype=Object.create(p);function v(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,r(t,a,"GeneratorFunction")),t.prototype=Object.create(d),t}return l.prototype=f,r(d,"constructor",f),r(f,"constructor",l),l.displayName="GeneratorFunction",r(f,a,"GeneratorFunction"),r(d),r(d,a,"Generator"),r(d,i,(function(){return this})),r(d,"toString",(function(){return"[object Generator]"})),(e=function(){return{w:c,m:v}})()}function r(t,e,n,o){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}r=function(t,e,n,o){function a(e,n){r(t,e,(function(t){return this._invoke(e,n,t)}))}e?i?i(t,e,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},r(t,e,n,o)}function o(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function i(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function c(t){o(a,r,i,c,u,"next",t)}function u(t){o(a,r,i,c,u,"throw",t)}c(void 0)}))}}const a=function(n){return i(e().m((function r(){var o,i,a;return e().w((function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("".concat(t,"/stories"),{headers:{Authorization:"Bearer ".concat(n)}});case 1:return o=e.v,e.n=2,o.json();case 2:if(i=e.v,o.ok){e.n=3;break}throw new Error(i.message||"Gagal memuat data cerita");case 3:return e.a(2,i.listStory||[]);case 4:return e.p=4,a=e.v,console.error("Gagal memuat data cerita:",a),e.a(2,[])}}),r,null,[[0,4]])})))()},c={saveSession:function(t){var e=t.token.replace(/^Bearer\s+/i,"");localStorage.setItem("token",e)},getToken:function(){return localStorage.getItem("token")},getAuthHeader:function(){var t=this.getToken();return t?"Bearer ".concat(t):""},clearSession:function(){localStorage.removeItem("token")}};function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function s(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return l(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function f(){}e=Object.getPrototypeOf;var p=[][r]?e(e([][r]())):(l(e={},r,(function(){return this})),e),d=f.prototype=c.prototype=Object.create(p);function v(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,l(t,o,"GeneratorFunction")),t.prototype=Object.create(d),t}return u.prototype=f,l(d,"constructor",f),l(f,"constructor",u),u.displayName="GeneratorFunction",l(f,o,"GeneratorFunction"),l(d),l(d,o,"Generator"),l(d,r,(function(){return this})),l(d,"toString",(function(){return"[object Generator]"})),(s=function(){return{w:i,m:v}})()}function l(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}l=function(t,e,n,r){function i(e,n){l(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},l(t,e,n,r)}function f(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function p(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){f(i,r,o,a,c,"next",t)}function c(t){f(i,r,o,a,c,"throw",t)}a(void 0)}))}}function d(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,v(r.key),r)}}function v(t){var e=function(t){if("object"!=u(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==u(e)?e:e+""}var y="stories";const m=new(function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.dbPromise=this._openDB()},e=[{key:"_openDB",value:function(){return new Promise((function(t,e){var n=indexedDB.open("story-favorite-db",1);n.onupgradeneeded=function(t){var e=t.target.result;e.objectStoreNames.contains(y)||e.createObjectStore(y,{keyPath:"id"})},n.onsuccess=function(e){return t(e.target.result)},n.onerror=function(t){return e(t.target.error)}}))}},{key:"getAllStories",value:(i=p(s().m((function t(){var e;return s().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,this.dbPromise;case 1:return e=t.v,t.a(2,new Promise((function(t,n){var r=e.transaction(y,"readonly").objectStore(y).getAll();r.onsuccess=function(){return t(r.result)},r.onerror=function(){return n(r.error)}})))}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"getStory",value:(o=p(s().m((function t(e){var n;return s().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,this.dbPromise;case 1:return n=t.v,t.a(2,new Promise((function(t,r){var o=n.transaction(y,"readonly").objectStore(y).get(e);o.onsuccess=function(){return t(o.result)},o.onerror=function(){return r(o.error)}})))}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"putStory",value:(r=p(s().m((function t(e){var n;return s().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,this.dbPromise;case 1:return n=t.v,t.a(2,new Promise((function(t,r){var o=n.transaction(y,"readwrite").objectStore(y).put(e);o.onsuccess=function(){return t(o.result)},o.onerror=function(){return r(o.error)}})))}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"deleteStory",value:(n=p(s().m((function t(e){var n;return s().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,this.dbPromise;case 1:return n=t.v,t.a(2,new Promise((function(t,r){var o=n.transaction(y,"readwrite").objectStore(y).delete(e);o.onsuccess=function(){return t(!0)},o.onerror=function(){return r(o.error)}})))}}),t,this)}))),function(t){return n.apply(this,arguments)})}],e&&d(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,o,i}());function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function b(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return g(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(g(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,g(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,g(f,"constructor",s),g(s,"constructor",u),u.displayName="GeneratorFunction",g(s,o,"GeneratorFunction"),g(f),g(f,o,"Generator"),g(f,r,(function(){return this})),g(f,"toString",(function(){return"[object Generator]"})),(b=function(){return{w:i,m:p}})()}function g(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}g=function(t,e,n,r){function i(e,n){g(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},g(t,e,n,r)}function w(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function k(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){w(i,r,o,a,c,"next",t)}function c(t){w(i,r,o,a,c,"throw",t)}a(void 0)}))}}function S(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,j(r.key),r)}}function j(t){var e=function(t){if("object"!=h(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=h(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==h(e)?e:e+""}var O=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"getStories",value:(i=k(b().m((function t(){var e;return b().w((function(t){for(;;)switch(t.n){case 0:if(e=c.getToken()){t.n=1;break}return t.a(2,[]);case 1:return t.n=2,a(e);case 2:return t.a(2,t.v)}}),t)}))),function(){return i.apply(this,arguments)})},{key:"addStory",value:(o=k(b().m((function t(e){var n,r,o;return b().w((function(t){for(;;)switch(t.n){case 0:return n=c.getAuthHeader(),t.n=1,fetch("https://story-api.dicoding.dev/v1/stories",{method:"POST",headers:{Authorization:n},body:e});case 1:return r=t.v,t.n=2,r.json();case 2:return o=t.v,t.a(2,o)}}),t)}))),function(t){return o.apply(this,arguments)})},{key:"saveFavorite",value:function(t){var e=JSON.parse(localStorage.getItem("favorites"))||[];e.some((function(e){return e.id===t.id}))||(e.push(t),localStorage.setItem("favorites",JSON.stringify(e)))}},{key:"getFavorites",value:(r=k(b().m((function t(){return b().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,m.getAllStories();case 1:return t.a(2,t.v)}}),t)}))),function(){return r.apply(this,arguments)})},{key:"deleteFavorite",value:(n=k(b().m((function t(e){return b().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,m.deleteStory(e);case 1:return t.a(2)}}),t)}))),function(t){return n.apply(this,arguments)})}],e&&S(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,o,i}();function P(t){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},P(t)}function E(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return T(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(T(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,T(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,T(f,"constructor",s),T(s,"constructor",u),u.displayName="GeneratorFunction",T(s,o,"GeneratorFunction"),T(f),T(f,o,"Generator"),T(f,r,(function(){return this})),T(f,"toString",(function(){return"[object Generator]"})),(E=function(){return{w:i,m:p}})()}function T(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}T=function(t,e,n,r){function i(e,n){T(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},T(t,e,n,r)}function _(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function G(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){_(i,r,o,a,c,"next",t)}function c(t){_(i,r,o,a,c,"throw",t)}a(void 0)}))}}function x(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,M(r.key),r)}}function M(t){var e=function(t){if("object"!=P(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=P(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==P(e)?e:e+""}var F=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"bindElements",value:function(){this.loadingElement=document.getElementById("loading"),this.container=document.getElementById("stories-container"),this.modal=document.getElementById("detailModal"),this.modalContent=document.getElementById("modal-content"),this.closeBtn=document.getElementById("closeModal")}},{key:"showLoading",value:function(){this.loadingElement&&(this.loadingElement.style.display="block")}},{key:"hideLoading",value:function(){this.loadingElement&&(this.loadingElement.style.display="none")}},{key:"displayStories",value:function(t){this.container&&(t.length?(this.container.innerHTML=t.map((function(t){return'\n      <article class="story-card" tabindex="0" data-id="'.concat(t.id,'">\n        <img \n          src="').concat(t.photoUrl,'" \n          alt="Gambar cerita ').concat(t.name,'" \n          class="story-image" \n          loading="lazy"\n        />\n        <h3 class="story-name">').concat(t.name,'</h3>\n        <p class="story-description">').concat(t.description,'</p>\n        <p class="story-date">').concat(new Date(t.createdAt).toLocaleString("id-ID"),'</p>\n        <div class="story-actions">\n          <button class="detail-button" data-id="').concat(t.id,'" aria-label="Lihat detail cerita ').concat(t.name,'">\n            üìñ Lihat Detail\n          </button>\n          <button class="save-fav" data-id="').concat(t.id,'" aria-label="Simpan cerita ').concat(t.name,'">\n            üíæ Simpan Story\n          </button>\n        </div>\n      </article>\n    ')})).join(""),this.bindSaveFavorite(t)):this.container.innerHTML='\n        <p class="no-stories" tabindex="0">Tidak ada cerita yang tersedia.</p>\n      ')}},{key:"bindAddStoryForm",value:function(t){var e=document.querySelector("#addStoryForm");e&&e.addEventListener("submit",(function(n){n.preventDefault();var r=new FormData(e);t(r)}))}},{key:"bindDetailButton",value:function(t,e){var n=this,r=document.getElementById("detailModal"),o=document.getElementById("modal-content"),i=document.getElementById("closeModal");r&&o?(document.querySelectorAll(".detail-button").forEach((function(e){e.addEventListener("click",(function(){var i=e.dataset.id,a=t.find((function(t){return t.id===i}));if(a){o.innerHTML='\n          <div class="modal-content-wrapper">\n            <span id="closeModalInner" class="close-button">&times;</span>\n            <img src="'.concat(a.photoUrl,'" alt="').concat(a.name,'" class="modal-image" />\n            <h3>').concat(a.name,'</h3>\n            <p class="modal-description">').concat(a.description,"</p>\n            ").concat(a.lat&&a.lon?'<button \n                    id="focusMapBtn" \n                    class="focus-map-btn" \n                    data-lat="'.concat(a.lat,'" \n                    data-lon="').concat(a.lon,'">\n                    üìç Lihat Lokasi di Peta\n                   </button>'):"<p><em>Tidak ada lokasi</em></p>","\n          </div>\n        "),r.style.display="flex",document.body.style.overflow="hidden";var c=document.getElementById("closeModalInner");c&&c.addEventListener("click",(function(){return n.hideModal()}));var u=document.getElementById("focusMapBtn");u&&u.addEventListener("click",(function(){var t=parseFloat(u.dataset.lat),e=parseFloat(u.dataset.lon);n.hideModal();var r="https://www.google.com/maps?q=".concat(t,",").concat(e);window.open(r,"_blank")}))}}))})),i&&i.addEventListener("click",(function(){return n.hideModal()})),window.addEventListener("click",(function(t){t.target===r&&n.hideModal()}))):console.warn("‚ö†Ô∏è Elemen modal belum ditemukan di DOM.")}},{key:"bindSaveFavorite",value:function(t){document.querySelectorAll(".save-fav").forEach((function(e){e.addEventListener("click",G(E().m((function n(){var r,o,i,a,c;return E().w((function(n){for(;;)switch(n.n){case 0:if(r=e.dataset.id,o=t.find((function(t){return t.id===r}))){n.n=1;break}return n.a(2);case 1:return i="favorites",a=function(){return new Promise((function(t,e){var n=indexedDB.open("story-favorites-db",1);n.onupgradeneeded=function(t){var e=t.target.result;e.objectStoreNames.contains(i)||e.createObjectStore(i,{keyPath:"id"})},n.onsuccess=function(e){return t(e.target.result)},n.onerror=function(t){return e(t.target.error)}}))},c=function(){var t=G(E().m((function t(e){var n,r;return E().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,a();case 1:return n=t.v,(r=n.transaction(i,"readwrite")).objectStore(i).put(e),t.a(2,new Promise((function(t){r.oncomplete=function(){return t(!0)}})))}}),t)})));return function(e){return t.apply(this,arguments)}}(),n.n=2,c(o);case 2:alert("‚úÖ Cerita disimpan ke favorit!");case 3:return n.a(2)}}),n)}))))}))}},{key:"hideModal",value:function(){var t=document.getElementById("detailModal");t&&(t.style.display="none"),document.body.style.overflow="auto"}}],e&&x(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function B(t){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B(t)}function I(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return A(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(A(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,A(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,A(f,"constructor",s),A(s,"constructor",u),u.displayName="GeneratorFunction",A(s,o,"GeneratorFunction"),A(f),A(f,o,"Generator"),A(f,r,(function(){return this})),A(f,"toString",(function(){return"[object Generator]"})),(I=function(){return{w:i,m:p}})()}function A(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}A=function(t,e,n,r){function i(e,n){A(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},A(t,e,n,r)}function C(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function D(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){C(i,r,o,a,c,"next",t)}function c(t){C(i,r,o,a,c,"throw",t)}a(void 0)}))}}function N(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,q(r.key),r)}}function q(t){var e=function(t){if("object"!=B(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=B(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==B(e)?e:e+""}const H=function(){return t=function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.model=e,this.view=n,this.map=null,this.markers=[]},e=[{key:"init",value:(i=D(I().m((function t(){var e;return I().w((function(t){for(;;)switch(t.n){case 0:if(localStorage.getItem("token")){t.n=1;break}return alert("Sesi login telah berakhir. Silakan login kembali."),window.location.hash="#/login",t.a(2);case 1:return t.n=2,this.showStories();case 2:e=t.v,this.initMap(),this.updateMapMarkers(e);case 3:return t.a(2)}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"showStories",value:(o=D(I().m((function t(){var e,n,r=this;return I().w((function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,this.view.showLoading(),t.n=1,this.model.getStories();case 1:return e=t.v,this.view.displayStories(e),this.stories=e,this.view.bindDetailButton(e,(function(t,e){r.map&&t&&e?(r.map.setView([t,e],15),L.marker([t,e]).addTo(r.map).bindPopup("Lokasi Cerita").openPopup(),setTimeout((function(){return r.map.flyTo([t,e],15,{duration:1.5})}),100)):console.warn("‚ùå Peta belum siap atau koordinat tidak valid")})),this.view.bindSaveFavorite(e,function(){var t=D(I().m((function t(e){var n;return I().w((function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,r.model.saveFavorite(e);case 1:alert('Story "'.concat(e.name,'" telah disimpan ke favorit!')),t.n=3;break;case 2:t.p=2,n=t.v,console.error("Gagal menyimpan story:",n),alert("‚ùå Terjadi kesalahan saat menyimpan story.");case 3:return t.a(2)}}),t,null,[[0,2]])})));return function(e){return t.apply(this,arguments)}}()),t.a(2,e);case 2:return t.p=2,n=t.v,console.error(n),this.view.showError(n.message),t.a(2,[]);case 3:return t.p=3,this.view.hideLoading(),t.f(3);case 4:return t.a(2)}}),t,this,[[0,2,3,4]])}))),function(){return o.apply(this,arguments)})},{key:"initMap",value:function(){if(document.getElementById("map")){this.map=L.map("map").setView([-2.5489,118.0149],5);var t=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"¬© OpenStreetMap contributors"}),e=L.tileLayer("https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",{attribution:"¬© Google Satellite",subdomains:["mt0","mt1","mt2","mt3"]});t.addTo(this.map),L.control.layers({"Street Map":t,Satellite:e}).addTo(this.map)}}},{key:"updateMapMarkers",value:function(t){var e=this;this.map&&(this.markers.forEach((function(t){return e.map.removeLayer(t)})),this.markers=[],t.forEach((function(t){if(t.lat&&t.lon){var n=L.marker([t.lat,t.lon]).addTo(e.map).bindPopup('\n            <div class="popup-content">\n              <img src="'.concat(t.photoUrl,'" alt="').concat(t.description,'" \n                   style="width: 100px; height: 100px; object-fit: cover;">\n              <h4>').concat(t.name,"</h4>\n              <p>").concat(t.description,"</p>\n            </div>\n          "));e.markers.push(n)}})))}},{key:"addStory",value:(r=D(I().m((function t(e){var n,r,o;return I().w((function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,this.model.addStory(e);case 1:if(!1!==(n=t.v).error){t.n=3;break}return t.n=2,this.showStories();case 2:return r=t.v,this.updateMapMarkers(r),t.a(2,{success:!0,message:n.message});case 3:throw new Error(n.message||"Gagal menambahkan cerita");case 4:t.n=6;break;case 5:return t.p=5,o=t.v,console.error("Gagal menambahkan cerita:",o),t.a(2,{success:!1,message:o.message});case 6:return t.a(2)}}),t,this,[[0,5]])}))),function(t){return r.apply(this,arguments)})},{key:"handleAddStory",value:(n=D(I().m((function t(e){var n,r;return I().w((function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,this.view.showLoading(),t.n=1,this.model.addStory(e);case 1:if(!1!==(n=t.v).error){t.n=3;break}return this.view.showMessage("Cerita berhasil ditambahkan!"),t.n=2,this.showStories();case 2:r=t.v,this.updateMapMarkers(r),t.n=4;break;case 3:this.view.showError(n.message);case 4:t.n=6;break;case 5:t.p=5,t.v,this.view.showError("Gagal menambahkan cerita!");case 6:return t.p=6,this.view.hideLoading(),t.f(6);case 7:return t.a(2)}}),t,this,[[0,5,6,7]])}))),function(t){return n.apply(this,arguments)})}],e&&N(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,o,i}();function W(t){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},W(t)}function z(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return U(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(U(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,U(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,U(f,"constructor",s),U(s,"constructor",u),u.displayName="GeneratorFunction",U(s,o,"GeneratorFunction"),U(f),U(f,o,"Generator"),U(f,r,(function(){return this})),U(f,"toString",(function(){return"[object Generator]"})),(z=function(){return{w:i,m:p}})()}function U(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}U=function(t,e,n,r){function i(e,n){U(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},U(t,e,n,r)}function V(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function R(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){V(i,r,o,a,c,"next",t)}function c(t){V(i,r,o,a,c,"throw",t)}a(void 0)}))}}function K(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,J(r.key),r)}}function J(t){var e=function(t){if("object"!=W(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=W(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==W(e)?e:e+""}var Y=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.model=new O,this.view=new F,this.presenter=new H(this.model,this.view)},e=[{key:"render",value:(r=R(z().m((function t(){return z().w((function(t){for(;;)if(0===t.n)return t.a(2,'\n      <section class="container">\n        <a href="#main-content" class="skip-link">Skip to content</a>\n        <h1 tabindex="0">Cerita Masyarakat</h1>\n        <div id="loading" class="loading" style="display: none;">Memuat data...</div>\n        \n        <div class="content-layout">\n          <aside class="stories-sidebar">\n            <h2 tabindex="0">Daftar Cerita</h2>\n            <div id="stories-container" class="stories-container"></div>\n          </aside>\n          \n          <main class="map-container">\n            <h2 tabindex="0">Peta Lokasi</h2>\n            <div id="map" class="map"></div>\n          </main>\n        </div>\n\n        \x3c!-- üîΩ Popup Detail --\x3e\n        <div id="detailModal" class="modal" style="display:none;">\n          <div class="modal-content-wrapper">\n            <span id="closeModal" class="close-button" aria-label="Tutup popup">&times;</span>\n            <div id="modal-content"></div>\n          </div>\n        </div>\n        \x3c!-- üîº Akhir modal --\x3e\n\n        <div class="floating-action">\n          <a href="#/add-story" class="fab" aria-label="Tambah cerita baru">+</a>\n        </div>\n      </section>\n    ')}),t)}))),function(){return r.apply(this,arguments)})},{key:"afterRender",value:(n=R(z().m((function t(){var e=this;return z().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,this.loadLeaflet();case 1:return this.view.bindElements(),t.n=2,this.presenter.init();case 2:setTimeout((function(){var t;document.querySelectorAll(".detail-button").length>0&&null!==(t=e.presenter.stories)&&void 0!==t&&t.length?e.view.bindDetailButton(e.presenter.stories,(function(t,n){if(e.presenter.map&&t&&n){e.presenter.map.setView([t,n],14);var r=e.presenter.markers.find((function(e){return e.getLatLng().lat===t&&e.getLatLng().lng===n}));r&&r.openPopup()}})):console.warn("‚ö†Ô∏è Tidak ditemukan tombol detail di DOM.")}),500),this.setupInteractions();case 3:return t.a(2)}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"loadLeaflet",value:function(){return new Promise((function(t){var e=document.createElement("link");e.rel="stylesheet",e.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(e);var n=document.createElement("script");n.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",n.onload=t,document.head.appendChild(n)}))}},{key:"setupInteractions",value:function(){var t=this;document.addEventListener("mouseover",(function(e){if(e.target.closest(".story-card")){var n=e.target.closest(".story-card").dataset.id,r=t.presenter.markers.find((function(t){return t._popup&&t._popup._content.includes('"'.concat(n,'"'))}));r&&r.openPopup()}}))}}],e&&K(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();function Q(t){return Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Q(t)}function $(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return X(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(X(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,X(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,X(f,"constructor",s),X(s,"constructor",u),u.displayName="GeneratorFunction",X(s,o,"GeneratorFunction"),X(f),X(f,o,"Generator"),X(f,r,(function(){return this})),X(f,"toString",(function(){return"[object Generator]"})),($=function(){return{w:i,m:p}})()}function X(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}X=function(t,e,n,r){function i(e,n){X(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},X(t,e,n,r)}function Z(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function tt(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Z(i,r,o,a,c,"next",t)}function c(t){Z(i,r,o,a,c,"throw",t)}a(void 0)}))}}function et(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,nt(r.key),r)}}function nt(t){var e=function(t){if("object"!=Q(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Q(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Q(e)?e:e+""}var rt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"render",value:(r=tt($().m((function t(){return $().w((function(t){for(;;)if(0===t.n)return t.a(2,'\n      <section class="container">\n        <a href="#main-content" class="skip-link">Skip to content</a>\n        <h1 tabindex="0">Tentang Aplikasi</h1>\n        \n        <article class="about-content">\n          <h2>Cerita Masyarakat</h2>\n          <p>Aplikasi ini dibuat untuk berbagi cerita dan pengalaman masyarakat dari berbagai lokasi di Indonesia.</p>\n          \n          <h3>Fitur Utama:</h3>\n          <ul>\n            <li>üìñ Membaca cerita dari berbagai daerah</li>\n            <li>üó∫Ô∏è Melihat lokasi cerita di peta interaktif</li>\n            <li>üìù Menambahkan cerita baru dengan foto</li>\n            <li>üì∑ Mengambil foto langsung dari kamera</li>\n            <li>üéØ Multiple layer peta (Street dan Satellite)</li>\n          </ul>\n          \n          <h3>Teknologi yang Digunakan:</h3>\n          <ul>\n            <li>JavaScript ES6+</li>\n            <li>Leaflet.js untuk peta</li>\n            <li>MVP Architecture</li>\n            <li>Webpack</li>\n            <li>Dicoding Story API</li>\n          </ul>\n        </article>\n      </section>\n    ')}),t)}))),function(){return r.apply(this,arguments)})},{key:"afterRender",value:(n=tt($().m((function t(){return $().w((function(t){for(;;)switch(t.n){case 0:document.querySelectorAll("h2, h3").forEach((function(t,e){t.setAttribute("tabindex","0")}));case 1:return t.a(2)}}),t)}))),function(){return n.apply(this,arguments)})}],e&&et(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();function ot(t){return ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ot(t)}function it(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return at(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(at(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,at(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,at(f,"constructor",s),at(s,"constructor",u),u.displayName="GeneratorFunction",at(s,o,"GeneratorFunction"),at(f),at(f,o,"Generator"),at(f,r,(function(){return this})),at(f,"toString",(function(){return"[object Generator]"})),(it=function(){return{w:i,m:p}})()}function at(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}at=function(t,e,n,r){function i(e,n){at(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},at(t,e,n,r)}function ct(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function ut(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,st(r.key),r)}}function st(t){var e=function(t){if("object"!=ot(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ot(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ot(e)?e:e+""}var lt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.stream=null},e=[{key:"startCamera",value:(n=it().m((function t(e){return it().w((function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});case 1:return this.stream=t.v,e.srcObject=this.stream,t.n=2,e.play();case 2:t.n=4;break;case 3:throw t.p=3,t.v,new Error("Tidak dapat mengakses kamera. Pastikan Anda memberikan izin akses kamera.");case 4:return t.a(2)}}),t,this,[[0,3]])})),r=function(){var t=this,e=arguments;return new Promise((function(r,o){var i=n.apply(t,e);function a(t){ct(i,r,o,a,c,"next",t)}function c(t){ct(i,r,o,a,c,"throw",t)}a(void 0)}))},function(t){return r.apply(this,arguments)})},{key:"capturePhoto",value:function(t){if(!this.stream)throw new Error("Kamera belum diaktifkan");var e=document.getElementById("camera-capture"),n=e.getContext("2d");return e.width=t.videoWidth,e.height=t.videoHeight,n.drawImage(t,0,0,e.width,e.height),new Promise((function(t){e.toBlob((function(e){var n=new File([e],"camera-photo.jpg",{type:"image/jpeg",lastModified:Date.now()});t(n)}),"image/jpeg",.8)}))}},{key:"stopCamera",value:function(){this.stream&&(this.stream.getTracks().forEach((function(t){return t.stop()})),this.stream=null)}}],e&&ut(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();function ft(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return pt(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(pt(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,pt(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,pt(f,"constructor",s),pt(s,"constructor",u),u.displayName="GeneratorFunction",pt(s,o,"GeneratorFunction"),pt(f),pt(f,o,"Generator"),pt(f,r,(function(){return this})),pt(f,"toString",(function(){return"[object Generator]"})),(ft=function(){return{w:i,m:p}})()}function pt(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}pt=function(t,e,n,r){function i(e,n){pt(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},pt(t,e,n,r)}function dt(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function vt(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){dt(i,r,o,a,c,"next",t)}function c(t){dt(i,r,o,a,c,"throw",t)}a(void 0)}))}}var yt="pending-stories";function mt(){return new Promise((function(t,e){var n=indexedDB.open("story-sync-db",1);n.onupgradeneeded=function(t){var e=t.target.result;e.objectStoreNames.contains(yt)||e.createObjectStore(yt,{keyPath:"createdAt"})},n.onsuccess=function(e){return t(e.target.result)},n.onerror=function(t){return e(t.target.error)}}))}function ht(t){return bt.apply(this,arguments)}function bt(){return(bt=vt(ft().m((function t(e){var n;return ft().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,mt();case 1:return n=t.v,t.a(2,new Promise((function(t,r){var o=n.transaction(yt,"readwrite");o.objectStore(yt).put(e),o.oncomplete=function(){return t()},o.onerror=function(t){return r(t)}})))}}),t)})))).apply(this,arguments)}function gt(){return wt.apply(this,arguments)}function wt(){return(wt=vt(ft().m((function t(){var e;return ft().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,mt();case 1:return e=t.v,t.a(2,new Promise((function(t,n){var r=e.transaction(yt,"readonly").objectStore(yt).getAll();r.onsuccess=function(){return t(r.result)},r.onerror=function(t){return n(t)}})))}}),t)})))).apply(this,arguments)}function kt(t){return St.apply(this,arguments)}function St(){return(St=vt(ft().m((function t(e){var n;return ft().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,mt();case 1:return n=t.v,t.a(2,new Promise((function(t,r){var o=n.transaction(yt,"readwrite");o.objectStore(yt).delete(e),o.oncomplete=function(){return t()},o.onerror=function(t){return r(t)}})))}}),t)})))).apply(this,arguments)}function jt(t){return jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jt(t)}function Ot(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return Pt(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(Pt(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,Pt(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,Pt(f,"constructor",s),Pt(s,"constructor",u),u.displayName="GeneratorFunction",Pt(s,o,"GeneratorFunction"),Pt(f),Pt(f,o,"Generator"),Pt(f,r,(function(){return this})),Pt(f,"toString",(function(){return"[object Generator]"})),(Ot=function(){return{w:i,m:p}})()}function Pt(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Pt=function(t,e,n,r){function i(e,n){Pt(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Pt(t,e,n,r)}function Et(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function Tt(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Et(i,r,o,a,c,"next",t)}function c(t){Et(i,r,o,a,c,"throw",t)}a(void 0)}))}}function _t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Gt(r.key),r)}}function Gt(t){var e=function(t){if("object"!=jt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=jt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==jt(e)?e:e+""}var Lt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.model=new O,this.view=new F,this.presenter=new H(this.model,this.view),this.camera=new lt,this.selectedLocation=null,this.map=null},e=[{key:"render",value:(i=Tt(Ot().m((function t(){return Ot().w((function(t){for(;;)if(0===t.n)return t.a(2,'\n      <section class="container">\n        <a href="#main-content" class="skip-link">Skip to content</a>\n        <h1 tabindex="0">Tambah Cerita Baru</h1>\n        \n        <form id="add-story-form" class="story-form">\n          <div class="form-group">\n            <label for="description">Deskripsi Cerita:</label>\n            <textarea id="description" name="description" required aria-required="true" rows="4"></textarea>\n            <span class="error-message" id="description-error"></span>\n          </div>\n\n          <div class="form-group">\n            <label for="photo">Foto:</label>\n            <input type="file" id="photo" name="photo" accept="image/*" required aria-required="true">\n            <span class="error-message" id="photo-error"></span>\n            \n            <div class="camera-options">\n              <button type="button" id="camera-btn" class="camera-btn">Ambil Foto dari Kamera</button>\n              <video id="camera-preview" style="display:none" aria-label="Preview kamera"></video>\n              <canvas id="camera-capture" style="display:none"></canvas>\n              <button type="button" id="capture-btn" style="display:none" class="capture-btn">Ambil Foto</button>\n            </div>\n\n            <div id="image-preview" class="image-preview"></div>\n          </div>\n\n          <div class="form-group">\n            <label>Pilih Lokasi di Peta:</label>\n            <div id="location-map" class="location-map"></div>\n            <p id="selected-location" class="location-info">Belum memilih lokasi</p>\n          </div>\n\n          <button type="submit" class="submit-btn">Tambah Cerita</button>\n          <div id="form-message" class="form-message"></div>\n        </form>\n      </section>\n    ')}),t)}))),function(){return i.apply(this,arguments)})},{key:"afterRender",value:(o=Tt(Ot().m((function t(){return Ot().w((function(t){for(;;)switch(t.n){case 0:if(localStorage.getItem("token")||(alert("Anda harus login terlebih dahulu!"),window.location.hash="#/login",0)){t.n=1;break}return t.a(2);case 1:return t.n=2,this.loadLeaflet();case 2:this.initMap(),this.setupFormValidation(),this.setupCamera();case 3:return t.a(2)}}),t,this)}))),function(){return o.apply(this,arguments)})},{key:"loadLeaflet",value:function(){return new Promise((function(t){if(window.L)return t();var e=document.createElement("link");e.rel="stylesheet",e.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(e);var n=document.createElement("script");n.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",n.onload=t,document.head.appendChild(n)}))}},{key:"initMap",value:function(){var t=this;this.map=L.map("location-map").setView([-2.5489,118.0149],5),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"¬© OpenStreetMap contributors"}).addTo(this.map),this.map.on("click",(function(e){t.selectedLocation=e.latlng,t.locationMarker&&t.map.removeLayer(t.locationMarker),t.locationMarker=L.marker(e.latlng).addTo(t.map).bindPopup("Lokasi terpilih").openPopup(),document.getElementById("selected-location").textContent="Lokasi terpilih: ".concat(e.latlng.lat.toFixed(4),", ").concat(e.latlng.lng.toFixed(4)),document.getElementById("selected-location").style.color=""}))}},{key:"setupFormValidation",value:function(){var t=this,e=document.getElementById("add-story-form"),n=document.getElementById("description"),r=document.getElementById("photo");n.addEventListener("input",(function(){t.validateField(n,"description-error","Deskripsi harus diisi")})),r.addEventListener("change",(function(e){t.validatePhoto(e.target)})),e.addEventListener("submit",function(){var e=Tt(Ot().m((function e(n){return Ot().w((function(e){for(;;)switch(e.n){case 0:return n.preventDefault(),e.n=1,t.validateForm();case 1:if(!e.v){e.n=2;break}return e.n=2,t.submitForm();case 2:return e.a(2)}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"validateField",value:function(t,e,n){var r=document.getElementById(e);return t.value.trim()?(r.textContent="",t.setAttribute("aria-invalid","false"),!0):(r.textContent=n,t.setAttribute("aria-invalid","true"),!1)}},{key:"validatePhoto",value:function(t){var e=document.getElementById("photo-error");if(t.files&&0!==t.files.length){e.textContent="",t.setAttribute("aria-invalid","false");var n=t.files[0],r=new FileReader;return r.onload=function(t){document.getElementById("image-preview").innerHTML='\n          <img src="'.concat(t.target.result,'" alt="Preview foto" class="preview-image">\n        ')},r.readAsDataURL(n),!0}return e.textContent="Foto harus dipilih",t.setAttribute("aria-invalid","true"),!1}},{key:"validateForm",value:(r=Tt(Ot().m((function t(){var e,n;return Ot().w((function(t){for(;;)switch(t.n){case 0:if(e=this.validateField(document.getElementById("description"),"description-error","Deskripsi harus diisi"),n=this.validatePhoto(document.getElementById("photo")),this.selectedLocation){t.n=1;break}return document.getElementById("selected-location").style.color="red",t.a(2,!1);case 1:return t.a(2,e&&n)}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"setupCamera",value:function(){var t=this,e=document.getElementById("camera-btn"),n=document.getElementById("camera-preview"),r=document.getElementById("capture-btn"),o=document.getElementById("photo"),i=document.createElement("button");i.textContent="Batalkan Kamera",i.type="button",i.className="cancel-btn",i.style.display="none",e.parentNode.insertBefore(i,n.nextSibling),e.addEventListener("click",Tt(Ot().m((function o(){var a;return Ot().w((function(o){for(;;)switch(o.p=o.n){case 0:return o.p=0,o.n=1,t.camera.startCamera(n);case 1:n.style.display="block",r.style.display="block",i.style.display="block",e.style.display="none",o.n=3;break;case 2:o.p=2,a=o.v,t.showMessage("Tidak dapat mengakses kamera: "+a.message,"error");case 3:return o.a(2)}}),o,null,[[0,2]])})))),r.addEventListener("click",Tt(Ot().m((function a(){var c,u,s;return Ot().w((function(a){for(;;)switch(a.p=a.n){case 0:return a.p=0,a.n=1,t.camera.capturePhoto(n);case 1:(c=a.v)instanceof File&&((u=new DataTransfer).items.add(c),o.files=u.files,o.dispatchEvent(new Event("change"))),t.camera.stopCamera(),n.style.display="none",r.style.display="none",i.style.display="none",e.style.display="block",a.n=3;break;case 2:a.p=2,s=a.v,t.showMessage("Gagal mengambil foto: "+s.message,"error");case 3:return a.a(2)}}),a,null,[[0,2]])})))),i.addEventListener("click",(function(){t.camera.stopCamera(),n.style.display="none",r.style.display="none",i.style.display="none",e.style.display="block"}))}},{key:"submitForm",value:(n=Tt(Ot().m((function t(){var e,n,r,o,i,a,c,u,s,l,f,p,d;return Ot().w((function(t){for(;;)switch(t.p=t.n){case 0:if(e=document.getElementById("add-story-form"),n=e.querySelector(".submit-btn"),r=document.getElementById("form-message"),o=localStorage.getItem("token")){t.n=1;break}return this.showMessage("Token tidak ditemukan. Silakan login ulang.","error"),window.location.hash="#/login",t.a(2);case 1:return t.p=1,n.disabled=!0,n.textContent="Mengirim...",r.textContent="",(i=new FormData).append("description",document.getElementById("description").value),i.append("photo",document.getElementById("photo").files[0]),this.selectedLocation&&(i.append("lat",this.selectedLocation.lat),i.append("lon",this.selectedLocation.lng)),t.n=2,this.presenter.addStory(i);case 2:if(!(a=t.v).success){t.n=3;break}this.showMessage("Cerita berhasil ditambahkan!","success"),e.reset(),document.getElementById("image-preview").innerHTML="",setTimeout((function(){return window.location.hash="#/"}),2e3),t.n=4;break;case 3:throw new Error(a.message);case 4:t.n=9;break;case 5:return t.p=5,d=t.v,console.warn("üì¥ Offline: menyimpan cerita ke pending DB",d),s=document.getElementById("photo").files[0],l=URL.createObjectURL(s),f={description:document.getElementById("description").value,photoUrl:l,lat:null===(c=this.selectedLocation)||void 0===c?void 0:c.lat,lon:null===(u=this.selectedLocation)||void 0===u?void 0:u.lng,createdAt:(new Date).toISOString()},t.n=6,ht(f);case 6:if(this.showMessage("üì¥ Offline: cerita disimpan dan akan dikirim saat online!","warning"),navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"SET_TOKEN",token:o}),!("serviceWorker"in navigator)||!("SyncManager"in window)){t.n=9;break}return t.n=7,navigator.serviceWorker.ready;case 7:return p=t.v,t.n=8,p.sync.register("sync-stories");case 8:console.log("üì° Cerita offline akan disinkronkan nanti.");case 9:return t.p=9,n.disabled=!1,n.textContent="Tambah Cerita",t.f(9);case 10:return t.a(2)}}),t,this,[[1,5,9,10]])}))),function(){return n.apply(this,arguments)})},{key:"showMessage",value:function(t,e){var n=document.getElementById("form-message");n.textContent=t,n.className="form-message ".concat(e)}}],e&&_t(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,o,i}();function xt(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return Mt(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(Mt(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,Mt(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,Mt(f,"constructor",s),Mt(s,"constructor",u),u.displayName="GeneratorFunction",Mt(s,o,"GeneratorFunction"),Mt(f),Mt(f,o,"Generator"),Mt(f,r,(function(){return this})),Mt(f,"toString",(function(){return"[object Generator]"})),(xt=function(){return{w:i,m:p}})()}function Mt(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Mt=function(t,e,n,r){function i(e,n){Mt(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Mt(t,e,n,r)}function Ft(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}const Bt=function(t){return(e=xt().m((function e(){var n,r,o,i,a,c,u;return xt().w((function(e){for(;;)switch(e.n){case 0:return i=t.email,a=t.password,e.n=1,fetch("https://story-api.dicoding.dev/v1/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i,password:a})});case 1:return c=e.v,e.n=2,c.json();case 2:if(u=e.v,c.ok&&!u.error){e.n=3;break}throw new Error(u.message||"Login gagal, periksa email dan password.");case 3:return e.a(2,{token:null===(n=u.loginResult)||void 0===n?void 0:n.token,name:null===(r=u.loginResult)||void 0===r?void 0:r.name,email:null===(o=u.loginResult)||void 0===o?void 0:o.email})}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(t){Ft(i,r,o,a,c,"next",t)}function c(t){Ft(i,r,o,a,c,"throw",t)}a(void 0)}))})();var e};function It(t){return It="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},It(t)}function At(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return Ct(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(Ct(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,Ct(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,Ct(f,"constructor",s),Ct(s,"constructor",u),u.displayName="GeneratorFunction",Ct(s,o,"GeneratorFunction"),Ct(f),Ct(f,o,"Generator"),Ct(f,r,(function(){return this})),Ct(f,"toString",(function(){return"[object Generator]"})),(At=function(){return{w:i,m:p}})()}function Ct(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Ct=function(t,e,n,r){function i(e,n){Ct(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Ct(t,e,n,r)}function Dt(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function Nt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,qt(r.key),r)}}function qt(t){var e=function(t){if("object"!=It(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=It(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==It(e)?e:e+""}var Ht=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.view=e},e=[{key:"login",value:(n=At().m((function t(e){var n,r,o,i,a=this;return At().w((function(t){for(;;)switch(t.p=t.n){case 0:if(n=e.email,r=e.password,n&&r){t.n=1;break}return this.view.showMessage("Email dan kata sandi wajib diisi.",!0),t.a(2);case 1:return this.view.showMessage("Memproses login..."),t.p=2,t.n=3,Bt({email:n,password:r});case 3:if(o=t.v,console.log("Hasil dari AuthModel.login():",o),o&&o.token){t.n=4;break}throw new Error("Token tidak ditemukan di respons API");case 4:c.saveSession(o),this.view.showMessage("Login berhasil! Mengalihkan..."),setTimeout((function(){return a.view.redirectToHome()}),1500),t.n=6;break;case 5:t.p=5,i=t.v,console.error("Login error:",i),this.view.showMessage("Login gagal: ".concat(i.message),!0);case 6:return t.a(2)}}),t,this,[[2,5]])})),r=function(){var t=this,e=arguments;return new Promise((function(r,o){var i=n.apply(t,e);function a(t){Dt(i,r,o,a,c,"next",t)}function c(t){Dt(i,r,o,a,c,"throw",t)}a(void 0)}))},function(t){return r.apply(this,arguments)})}],e&&Nt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();function Wt(t){return Wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wt(t)}function zt(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return Ut(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(Ut(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,Ut(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,Ut(f,"constructor",s),Ut(s,"constructor",u),u.displayName="GeneratorFunction",Ut(s,o,"GeneratorFunction"),Ut(f),Ut(f,o,"Generator"),Ut(f,r,(function(){return this})),Ut(f,"toString",(function(){return"[object Generator]"})),(zt=function(){return{w:i,m:p}})()}function Ut(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Ut=function(t,e,n,r){function i(e,n){Ut(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Ut(t,e,n,r)}function Vt(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function Rt(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Vt(i,r,o,a,c,"next",t)}function c(t){Vt(i,r,o,a,c,"throw",t)}a(void 0)}))}}function Kt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Jt(r.key),r)}}function Jt(t){var e=function(t){if("object"!=Wt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Wt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Wt(e)?e:e+""}var Yt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"render",value:(r=Rt(zt().m((function t(){return zt().w((function(t){for(;;)if(0===t.n)return t.a(2,'\n      <section class="login-container">\n        <div class="login-card">\n          <img src="./images/logo.png" alt="Logo Aplikasi" class="login-logo" />\n          <h2 tabindex="0">Masuk ke Aplikasi</h2>\n\n          <form id="login-form" class="login-form">\n            <div class="form-group">\n              <label for="email">Email</label>\n              <input type="email" id="email" name="email" required placeholder="Masukkan email" />\n            </div>\n\n            <div class="form-group">\n              <label for="password">Kata Sandi</label>\n              <input type="password" id="password" name="password" required placeholder="Masukkan kata sandi" />\n            </div>\n\n            <button type="submit" class="login-btn">Masuk</button>\n            <p id="login-message" class="login-message"></p>\n          </form>\n        </div>\n      </section>\n    ')}),t)}))),function(){return r.apply(this,arguments)})},{key:"afterRender",value:(n=Rt(zt().m((function t(){var e,n;return zt().w((function(t){for(;;)switch(t.n){case 0:e=document.getElementById("login-form"),document.getElementById("login-message"),n=new Ht(this),e.addEventListener("submit",function(){var t=Rt(zt().m((function t(e){var r,o;return zt().w((function(t){for(;;)switch(t.n){case 0:return e.preventDefault(),r=document.getElementById("email").value.trim(),o=document.getElementById("password").value.trim(),t.n=1,n.login({email:r,password:o});case 1:return t.a(2)}}),t)})));return function(e){return t.apply(this,arguments)}}());case 1:return t.a(2)}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"showMessage",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.getElementById("login-message");n.textContent=t,n.className="login-message ".concat(e?"error":"success")}},{key:"redirectToHome",value:function(){window.location.hash="#/"}}],e&&Kt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();function Qt(t){return Qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qt(t)}function $t(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return Xt(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(Xt(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,Xt(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,Xt(f,"constructor",s),Xt(s,"constructor",u),u.displayName="GeneratorFunction",Xt(s,o,"GeneratorFunction"),Xt(f),Xt(f,o,"Generator"),Xt(f,r,(function(){return this})),Xt(f,"toString",(function(){return"[object Generator]"})),($t=function(){return{w:i,m:p}})()}function Xt(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Xt=function(t,e,n,r){function i(e,n){Xt(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Xt(t,e,n,r)}function Zt(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function te(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Zt(i,r,o,a,c,"next",t)}function c(t){Zt(i,r,o,a,c,"throw",t)}a(void 0)}))}}function ee(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ne(r.key),r)}}function ne(t){var e=function(t){if("object"!=Qt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Qt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Qt(e)?e:e+""}var re=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"render",value:(r=te($t().m((function t(){return $t().w((function(t){for(;;)if(0===t.n)return t.a(2,'\n      <section class="favorite-page">\n        <h2>üìö Cerita Tersimpan</h2>\n        <div id="favorites-container" class="favorites-list"></div>\n      </section>\n    ')}),t)}))),function(){return r.apply(this,arguments)})},{key:"afterRender",value:(n=te($t().m((function t(){var e,n,r,o,i,a,c,u;return $t().w((function(t){for(;;)switch(t.n){case 0:if(e=document.getElementById("favorites-container")){t.n=1;break}return t.a(2);case 1:return n="favorites",o=function(){return new Promise((function(t,e){var o=indexedDB.open("story-favorites-db",1);o.onupgradeneeded=function(t){(r=t.target.result).objectStoreNames.contains(n)||r.createObjectStore(n,{keyPath:"id"})},o.onsuccess=function(e){r=e.target.result,t(r)},o.onerror=function(t){e(t.target.error)}}))},i=function(){return new Promise(function(){var t=te($t().m((function t(e){var r,i,a,c;return $t().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,o();case 1:r=t.v,i=r.transaction(n,"readonly"),a=i.objectStore(n),(c=a.getAll()).onsuccess=function(){return e(c.result||[])},c.onerror=function(){return e([])};case 2:return t.a(2)}}),t)})));return function(e){return t.apply(this,arguments)}}())},a=function(){var t=te($t().m((function t(e){var r,i;return $t().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,o();case 1:r=t.v,(i=r.transaction(n,"readwrite")).objectStore(n).delete(e),i.oncomplete=function(){return c()};case 2:return t.a(2)}}),t)})));return function(e){return t.apply(this,arguments)}}(),c=function(){var t=te($t().m((function t(){var n;return $t().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,i();case 1:if((n=t.v).length){t.n=2;break}return e.innerHTML='\n          <p class="no-favorites">Belum ada cerita yang disimpan üíæ</p>\n        ',t.a(2);case 2:e.innerHTML=n.map((function(t){return'\n          <article class="favorite-card" tabindex="0" data-id="'.concat(t.id,'">\n            <img \n              src="').concat(t.photoUrl,'" \n              alt="Gambar ').concat(t.name,'" \n              class="favorite-image" \n              loading="lazy"\n            />\n            <h3>').concat(t.name,"</h3>\n            <p>").concat(t.description,'</p>\n            <p class="story-date">').concat(new Date(t.createdAt).toLocaleString("id-ID"),'</p>\n            <div class="favorite-actions">\n              <button class="view-map" data-lat="').concat(t.lat,'" data-lon="').concat(t.lon,'">üìç Lihat Lokasi</button>\n              <button class="remove-fav" data-id="').concat(t.id,'">üóëÔ∏è Hapus</button>\n            </div>\n          </article>\n        ')})).join(""),u();case 3:return t.a(2)}}),t)})));return function(){return t.apply(this,arguments)}}(),u=function(){document.querySelectorAll(".view-map").forEach((function(t){t.addEventListener("click",(function(){var e=t.dataset.lat,n=t.dataset.lon;e&&n?window.open("https://www.google.com/maps?q=".concat(e,",").concat(n),"_blank"):alert("Lokasi tidak tersedia untuk cerita ini.")}))})),document.querySelectorAll(".remove-fav").forEach((function(t){t.addEventListener("click",te($t().m((function e(){var n;return $t().w((function(e){for(;;)switch(e.n){case 0:return n=t.dataset.id,e.n=1,a(n);case 1:return e.a(2)}}),e)}))))}))},t.n=2,c();case 2:return t.a(2)}}),t)}))),function(){return n.apply(this,arguments)})}],e&&ee(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();function oe(){return!!localStorage.getItem("token")||(alert("Anda harus login terlebih dahulu!"),window.location.hash="#/login",!1)}const ie={"/":new Y,"/about":new rt,"/add-story":new Lt,"/login":new Yt,"/favorite":new re};function ae(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body;document.startViewTransition?document.startViewTransition((function(){t()})):(t(),function(t){t.style.opacity="0",t.style.transform="translateY(20px)",t.style.transition="opacity 0.3s ease, transform 0.3s ease",requestAnimationFrame((function(){t.style.opacity="1",t.style.transform="translateY(0)"})),setTimeout((function(){t.style.transition=""}),300)}(e))}function ce(t){return ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ce(t)}function ue(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return se(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(se(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,se(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,se(f,"constructor",s),se(s,"constructor",u),u.displayName="GeneratorFunction",se(s,o,"GeneratorFunction"),se(f),se(f,o,"Generator"),se(f,r,(function(){return this})),se(f,"toString",(function(){return"[object Generator]"})),(ue=function(){return{w:i,m:p}})()}function se(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}se=function(t,e,n,r){function i(e,n){se(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},se(t,e,n,r)}function le(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function fe(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){le(i,r,o,a,c,"next",t)}function c(t){le(i,r,o,a,c,"throw",t)}a(void 0)}))}}function pe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,de(r.key),r)}}function de(t){var e=function(t){if("object"!=ce(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ce(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ce(e)?e:e+""}function ve(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function ye(t,e){return t.get(he(t,e))}function me(t,e,n){return t.set(he(t,e),n),n}function he(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var be=new WeakMap,ge=new WeakMap,we=new WeakMap;const ke=function(){return t=function t(e){var n=e.navigationDrawer,r=e.drawerButton,o=e.content;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ve(this,be,null),ve(this,ge,null),ve(this,we,null),me(be,this,o),me(ge,this,r),me(we,this,n),this._setupDrawer(),this._setupAccessibility(),this._updateAuthNav()},e=[{key:"_setupDrawer",value:function(){var t=this;ye(ge,this).addEventListener("click",(function(){ye(we,t).classList.toggle("open")})),ye(ge,this).addEventListener("keydown",(function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),ye(we,t).classList.toggle("open"))})),document.body.addEventListener("click",(function(e){ye(we,t).contains(e.target)||ye(ge,t).contains(e.target)||ye(we,t).classList.remove("open"),ye(we,t).querySelectorAll("a").forEach((function(n){n.contains(e.target)&&ye(we,t).classList.remove("open")}))}))}},{key:"_setupAccessibility",value:function(){var t=this,e=document.querySelector(".skip-link");e&&e.addEventListener("click",(function(t){t.preventDefault();var e=document.querySelector("#main-content");e.setAttribute("tabindex","-1"),e.focus()})),ye(we,this).addEventListener("keydown",(function(e){"Escape"===e.key&&(ye(we,t).classList.remove("open"),ye(ge,t).focus())}))}},{key:"renderPage",value:(n=fe(ue().m((function t(){var e,n,r,o=this;return ue().w((function(t){for(;;)switch(t.n){case 0:if(c=location.hash.replace("#","")||"/",u=void 0,u=c.split("/"),i={resource:u[1]||null,id:u[2]||null},a=void 0,a="",i.resource&&(a=a.concat("/".concat(i.resource))),i.id&&(a=a.concat("/:id")),n=ie[e=a||"/"],!["/add-story"].includes(e)||oe()){t.n=1;break}return t.a(2);case 1:if(!n){t.n=4;break}if(!document.startViewTransition){t.n=2;break}document.startViewTransition(fe(ue().m((function t(){return ue().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,n.render();case 1:return ye(be,o).innerHTML=t.v,t.n=2,n.afterRender();case 2:return t.a(2)}}),t)})))),t.n=3;break;case 2:return t.n=3,ae(fe(ue().m((function t(){return ue().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,n.render();case 1:return ye(be,o).innerHTML=t.v,t.n=2,n.afterRender();case 2:return t.a(2)}}),t)}))),ye(be,this));case 3:(r=ye(be,this).querySelector("h1"))&&r.hasAttribute("tabindex")&&r.focus(),this._updateAuthNav();case 4:return t.a(2)}var i,a,c,u}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"_updateAuthNav",value:function(){var t=this,e=document.querySelector("#nav-auth");e&&(oe()?(e.innerHTML='<button id="logout-btn" class="logout-btn">Logout</button>',document.querySelector("#logout-btn").addEventListener("click",(function(){localStorage.removeItem("authToken"),window.location.hash="#/login",t._updateAuthNav()}))):e.innerHTML='<a href="#/login">Login</a>')}}],e&&pe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n}();function Se(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return je(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?je(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function je(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Oe(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return Pe(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(Pe(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,Pe(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,Pe(f,"constructor",s),Pe(s,"constructor",u),u.displayName="GeneratorFunction",Pe(s,o,"GeneratorFunction"),Pe(f),Pe(f,o,"Generator"),Pe(f,r,(function(){return this})),Pe(f,"toString",(function(){return"[object Generator]"})),(Oe=function(){return{w:i,m:p}})()}function Pe(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Pe=function(t,e,n,r){function i(e,n){Pe(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Pe(t,e,n,r)}function Ee(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function Te(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Ee(i,r,o,a,c,"next",t)}function c(t){Ee(i,r,o,a,c,"throw",t)}a(void 0)}))}}function _e(t){return Ge.apply(this,arguments)}function Ge(){return(Ge=Te(Oe().m((function t(e){var n,r,o;return Oe().w((function(t){for(;;)switch(t.p=t.n){case 0:return t.n=1,Notification.requestPermission();case 1:if("granted"===t.v){t.n=2;break}return console.log("üö´ Izin notifikasi ditolak oleh user"),t.a(2);case 2:return console.log("üîî Notifikasi diizinkan oleh user"),n=Le("BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk"),t.p=3,t.n=4,e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n});case 4:r=t.v,console.log("‚úÖ Push Subscription berhasil dibuat:",r),t.n=6;break;case 5:t.p=5,o=t.v,console.error("üö´ Gagal membuat Push Subscription:",o);case 6:return t.a(2)}}),t,null,[[3,5]])})))).apply(this,arguments)}function Le(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),o=0;o<n.length;++o)r[o]=n.charCodeAt(o);return r}function xe(){return Me.apply(this,arguments)}function Me(){return(Me=Te(Oe().m((function t(){var e,n,r;return Oe().w((function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,e=document.getElementById("storyList")){t.n=1;break}return t.a(2);case 1:return t.n=2,gt();case 2:n=t.v,e.querySelectorAll(".story-item.pending").forEach((function(t){return t.remove()})),n.forEach((function(t){var n=document.createElement("div");n.classList.add("story-item","pending"),n.style.opacity="0.7",n.innerHTML="\n        <h3>".concat(t.name," (Offline)</h3>\n        <p>").concat(t.description,"</p>\n        ").concat(t.photo?'<img src="'.concat(t.photo,'" alt="photo" style="width:100%;max-height:200px;object-fit:cover;border-radius:8px;margin-top:8px;" />'):"","\n        <small>‚è≥ Menunggu sinkronisasi...</small>\n      "),e.prepend(n)})),t.n=4;break;case 3:t.p=3,r=t.v,console.error("‚ùå Gagal menampilkan cerita offline:",r);case 4:return t.a(2)}}),t,null,[[0,3]])})))).apply(this,arguments)}function Fe(){return Be.apply(this,arguments)}function Be(){return(Be=Te(Oe().m((function t(){var e,n,r,o,i,a,c,u,s,l,f,p,d,v;return Oe().w((function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,gt();case 1:if(0!==(e=t.v).length){t.n=2;break}return console.log("‚úÖ Tidak ada cerita pending untuk disinkronkan."),t.a(2);case 2:console.log("üì§ Sinkronisasi ".concat(e.length," cerita...")),n=Se(e),t.p=3,n.s();case 4:if((r=n.n()).done){t.n=15;break}if(o=r.value,t.p=5,(i=new FormData).append("description",o.description),!o.photo){t.n=8;break}return t.n=6,fetch(o.photo);case 6:return a=t.v,t.n=7,a.blob();case 7:c=t.v,i.append("photo",c,"offline-photo.jpg");case 8:return u=localStorage.getItem("authToken"),t.n=9,fetch("https://story-api.dicoding.dev/v1/stories",{method:"POST",headers:{Authorization:"Bearer ".concat(u)},body:i});case 9:return s=t.v,t.n=10,s.json();case 10:if(l=t.v,s.ok){t.n=11;break}throw new Error(l.message);case 11:return console.log('‚úÖ Cerita "'.concat(o.description,'" berhasil disinkronkan.')),t.n=12,kt(o.createdAt);case 12:(f=document.querySelector('.story-item.pending h3:contains("'.concat(o.name,'")')))&&f.parentElement&&f.parentElement.remove(),t.n=14;break;case 13:t.p=13,p=t.v,console.error("üö´ Gagal mengirim cerita:",p);case 14:t.n=4;break;case 15:t.n=17;break;case 16:t.p=16,d=t.v,n.e(d);case 17:return t.p=17,n.f(),t.f(17);case 18:return t.n=19,xe();case 19:t.n=21;break;case 20:t.p=20,v=t.v,console.error("‚ö†Ô∏è Gagal sinkronisasi cerita offline:",v);case 21:return t.a(2)}}),t,null,[[5,13],[3,16,17,18],[0,20]])})))).apply(this,arguments)}n(897),document.addEventListener("DOMContentLoaded",Te(Oe().m((function t(){var e,n,r,o,i,a;return Oe().w((function(t){for(;;)switch(t.p=t.n){case 0:return e=new ke({content:document.querySelector("#main-content"),drawerButton:document.querySelector("#drawer-button"),navigationDrawer:document.querySelector("#navigation-drawer")}),t.n=1,e.renderPage();case 1:if(xe(),window.addEventListener("hashchange",Te(Oe().m((function t(){return Oe().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,e.renderPage();case 1:xe();case 2:return t.a(2)}}),t)})))),!("serviceWorker"in navigator)){t.n=15;break}return t.p=2,t.n=3,navigator.serviceWorker.register("./sw.js");case 3:if(n=t.v,console.log("‚úÖ Service Worker terdaftar:",n),n.active){t.n=5;break}return console.log("‚è≥ Menunggu Service Worker aktif..."),t.n=4,new Promise((function(t){n.addEventListener("updatefound",(function(){var e=n.installing;e.addEventListener("statechange",(function(){"activated"===e.state&&(console.log("üî• Service Worker sudah aktif"),t())}))}))}));case 4:t.n=6;break;case 5:console.log("üî• Service Worker sudah aktif");case 6:if(!("SyncManager"in window)){t.n=11;break}return t.p=7,t.n=8,n.sync.register("sync-stories");case 8:console.log("üì° Background Sync: sync-stories terdaftar"),t.n=10;break;case 9:t.p=9,i=t.v,console.error("üö´ Gagal mendaftarkan Background Sync:",i);case 10:t.n=12;break;case 11:console.warn("‚ö†Ô∏è Browser tidak mendukung Background Sync");case 12:return t.n=13,_e(n);case 13:t.n=15;break;case 14:t.p=14,a=t.v,console.error("üö´ Gagal mendaftarkan Service Worker atau Push Notification:",a);case 15:o=document.getElementById("install-btn"),window.addEventListener("beforeinstallprompt",(function(t){t.preventDefault(),r=t,o.hidden=!1,console.log("üì≤ Install prompt tersedia")})),o.addEventListener("click",Te(Oe().m((function t(){var e,n;return Oe().w((function(t){for(;;)switch(t.n){case 0:if(o.hidden=!0,!r){t.n=2;break}return r.prompt(),t.n=1,r.userChoice;case 1:e=t.v,n=e.outcome,console.log("üí° User memilih: ".concat(n)),r=null;case 2:return t.a(2)}}),t)})))),window.addEventListener("appinstalled",(function(){console.log("‚úÖ Aplikasi telah diinstal"),o.hidden=!0,alert("üéâ Terima kasih! Cerita Masyarakat berhasil diinstal.")})),window.addEventListener("online",Te(Oe().m((function t(){return Oe().w((function(t){for(;;)switch(t.n){case 0:return console.log("üåê Kembali online, mulai sinkronisasi cerita..."),t.n=1,Fe();case 1:return t.a(2)}}),t)}))));case 16:return t.a(2)}}),t,null,[[7,9],[2,14]])}))))})()})();