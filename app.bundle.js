/*! For license information please see app.bundle.js.LICENSE.txt */
(()=>{"use strict";const t="https://story-api.dicoding.dev/v1";function e(){var t,r,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function c(e,o,i,a){var c=o&&o.prototype instanceof s?o:s,l=Object.create(c.prototype);return n(l,"_invoke",function(e,n,o){var i,a,c,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,a=0,c=t,p.n=n,u}};function d(e,n){for(a=e,c=n,r=0;!f&&s&&!o&&r<l.length;r++){var o,i=l[r],d=p.p,v=i[2];e>3?(o=v===n)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=e<2&&d<i[1])?(a=0,p.v=n,p.n=i[1]):d<v&&(o=e<3||i[0]>n||n>v)&&(i[4]=e,i[5]=n,p.n=v,a=0))}if(o||e>1)return u;throw f=!0,n}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),a=l,c=v;(r=a<2?t:c)||!f;){i||(a?a<3?(a>1&&(p.n=-1),d(a,c)):p.n=c:p.v=c);try{if(s=2,i){if(a||(o="next"),r=i[o]){if(!(r=r.call(i,c)))throw TypeError("iterator result is not an object");if(!r.done)return r;c=r.value,a<2&&(a=0)}else 1===a&&(r=i.return)&&r.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=t}else if((r=(f=p.n<0)?c:e.call(n,p))!==u)break}catch(e){i=t,a=1,c=e}finally{s=1}}return{value:r,done:f}}}(e,i,a),!0),l}var u={};function s(){}function l(){}function f(){}r=Object.getPrototypeOf;var p=[][i]?r(r([][i]())):(n(r={},i,(function(){return this})),r),d=f.prototype=s.prototype=Object.create(p);function v(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,n(t,a,"GeneratorFunction")),t.prototype=Object.create(d),t}return l.prototype=f,n(d,"constructor",f),n(f,"constructor",l),l.displayName="GeneratorFunction",n(f,a,"GeneratorFunction"),n(d),n(d,a,"Generator"),n(d,i,(function(){return this})),n(d,"toString",(function(){return"[object Generator]"})),(e=function(){return{w:c,m:v}})()}function n(t,e,r,o){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}n=function(t,e,r,o){function a(e,r){n(t,e,(function(t){return this._invoke(e,r,t)}))}e?i?i(t,e,{value:r,enumerable:!o,configurable:!o,writable:!o}):t[e]=r:(a("next",0),a("throw",1),a("return",2))},n(t,e,r,o)}function r(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function o(t){return function(){var e=this,n=arguments;return new Promise((function(o,i){var a=t.apply(e,n);function c(t){r(a,o,i,c,u,"next",t)}function u(t){r(a,o,i,c,u,"throw",t)}c(void 0)}))}}const i=function(n){return o(e().m((function r(){var o,i,a;return e().w((function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("".concat(t,"/stories"),{headers:{Authorization:"Bearer ".concat(n)}});case 1:return o=e.v,e.n=2,o.json();case 2:if(i=e.v,o.ok){e.n=3;break}throw new Error(i.message||"Gagal memuat data cerita");case 3:return e.a(2,i.listStory||[]);case 4:return e.p=4,a=e.v,console.error("Gagal memuat data cerita:",a),e.a(2,[])}}),r,null,[[0,4]])})))()},a={saveSession:function(t){var e=t.token.replace(/^Bearer\s+/i,"");localStorage.setItem("token",e)},getToken:function(){return localStorage.getItem("token")},getAuthHeader:function(){var t=this.getToken();return t?"Bearer ".concat(t):""},clearSession:function(){localStorage.removeItem("token")}};function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function u(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,l=Object.create(u.prototype);return s(l,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),l}var a={};function c(){}function l(){}function f(){}e=Object.getPrototypeOf;var p=[][r]?e(e([][r]())):(s(e={},r,(function(){return this})),e),d=f.prototype=c.prototype=Object.create(p);function v(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,s(t,o,"GeneratorFunction")),t.prototype=Object.create(d),t}return l.prototype=f,s(d,"constructor",f),s(f,"constructor",l),l.displayName="GeneratorFunction",s(f,o,"GeneratorFunction"),s(d),s(d,o,"Generator"),s(d,r,(function(){return this})),s(d,"toString",(function(){return"[object Generator]"})),(u=function(){return{w:i,m:v}})()}function s(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}s=function(t,e,n,r){function i(e,n){s(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},s(t,e,n,r)}function l(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function f(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){l(i,r,o,a,c,"next",t)}function c(t){l(i,r,o,a,c,"throw",t)}a(void 0)}))}}function p(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,d(r.key),r)}}function d(t){var e=function(t){if("object"!=c(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==c(e)?e:e+""}var v="stories";const y=new(function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.dbPromise=this._openDB()},e=[{key:"_openDB",value:function(){return new Promise((function(t,e){var n=indexedDB.open("story-favorite-db",1);n.onupgradeneeded=function(t){var e=t.target.result;e.objectStoreNames.contains(v)||e.createObjectStore(v,{keyPath:"id"})},n.onsuccess=function(e){return t(e.target.result)},n.onerror=function(t){return e(t.target.error)}}))}},{key:"getAllStories",value:(i=f(u().m((function t(){var e;return u().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,this.dbPromise;case 1:return e=t.v,t.a(2,new Promise((function(t,n){var r=e.transaction(v,"readonly").objectStore(v).getAll();r.onsuccess=function(){return t(r.result)},r.onerror=function(){return n(r.error)}})))}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"getStory",value:(o=f(u().m((function t(e){var n;return u().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,this.dbPromise;case 1:return n=t.v,t.a(2,new Promise((function(t,r){var o=n.transaction(v,"readonly").objectStore(v).get(e);o.onsuccess=function(){return t(o.result)},o.onerror=function(){return r(o.error)}})))}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"putStory",value:(r=f(u().m((function t(e){var n;return u().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,this.dbPromise;case 1:return n=t.v,t.a(2,new Promise((function(t,r){var o=n.transaction(v,"readwrite").objectStore(v).put(e);o.onsuccess=function(){return t(o.result)},o.onerror=function(){return r(o.error)}})))}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"deleteStory",value:(n=f(u().m((function t(e){var n;return u().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,this.dbPromise;case 1:return n=t.v,t.a(2,new Promise((function(t,r){var o=n.transaction(v,"readwrite").objectStore(v).delete(e);o.onsuccess=function(){return t(!0)},o.onerror=function(){return r(o.error)}})))}}),t,this)}))),function(t){return n.apply(this,arguments)})}],e&&p(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,o,i}());function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function h(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return b(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(b(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,b(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,b(f,"constructor",s),b(s,"constructor",u),u.displayName="GeneratorFunction",b(s,o,"GeneratorFunction"),b(f),b(f,o,"Generator"),b(f,r,(function(){return this})),b(f,"toString",(function(){return"[object Generator]"})),(h=function(){return{w:i,m:p}})()}function b(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}b=function(t,e,n,r){function i(e,n){b(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},b(t,e,n,r)}function g(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function w(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){g(i,r,o,a,c,"next",t)}function c(t){g(i,r,o,a,c,"throw",t)}a(void 0)}))}}function k(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,S(r.key),r)}}function S(t){var e=function(t){if("object"!=m(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=m(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==m(e)?e:e+""}var j=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"getStories",value:(c=w(h().m((function t(){var e;return h().w((function(t){for(;;)switch(t.n){case 0:if(e=a.getToken()){t.n=1;break}return t.a(2,[]);case 1:return t.n=2,i(e);case 2:return t.a(2,t.v)}}),t)}))),function(){return c.apply(this,arguments)})},{key:"addStory",value:(o=w(h().m((function t(e){var n,r,o;return h().w((function(t){for(;;)switch(t.n){case 0:return n=a.getAuthHeader(),t.n=1,fetch("https://story-api.dicoding.dev/v1/stories",{method:"POST",headers:{Authorization:n},body:e});case 1:return r=t.v,t.n=2,r.json();case 2:return o=t.v,t.a(2,o)}}),t)}))),function(t){return o.apply(this,arguments)})},{key:"saveFavorite",value:function(t){var e=JSON.parse(localStorage.getItem("favorites"))||[];e.some((function(e){return e.id===t.id}))||(e.push(t),localStorage.setItem("favorites",JSON.stringify(e)))}},{key:"getFavorites",value:(r=w(h().m((function t(){return h().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,y.getAllStories();case 1:return t.a(2,t.v)}}),t)}))),function(){return r.apply(this,arguments)})},{key:"deleteFavorite",value:(n=w(h().m((function t(e){return h().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,y.deleteStory(e);case 1:return t.a(2)}}),t)}))),function(t){return n.apply(this,arguments)})}],e&&k(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,o,c}();function O(t){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(t)}function P(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return E(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(E(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,E(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,E(f,"constructor",s),E(s,"constructor",u),u.displayName="GeneratorFunction",E(s,o,"GeneratorFunction"),E(f),E(f,o,"Generator"),E(f,r,(function(){return this})),E(f,"toString",(function(){return"[object Generator]"})),(P=function(){return{w:i,m:p}})()}function E(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}E=function(t,e,n,r){function i(e,n){E(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},E(t,e,n,r)}function T(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function _(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){T(i,r,o,a,c,"next",t)}function c(t){T(i,r,o,a,c,"throw",t)}a(void 0)}))}}function G(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,x(r.key),r)}}function x(t){var e=function(t){if("object"!=O(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=O(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==O(e)?e:e+""}var M=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"bindElements",value:function(){this.loadingElement=document.getElementById("loading"),this.container=document.getElementById("stories-container"),this.modal=document.getElementById("detailModal"),this.modalContent=document.getElementById("modal-content"),this.closeBtn=document.getElementById("closeModal")}},{key:"showLoading",value:function(){this.loadingElement&&(this.loadingElement.style.display="block")}},{key:"hideLoading",value:function(){this.loadingElement&&(this.loadingElement.style.display="none")}},{key:"displayStories",value:function(t){this.container&&(t.length?(this.container.innerHTML=t.map((function(t){return'\n      <article class="story-card" tabindex="0" data-id="'.concat(t.id,'">\n        <img \n          src="').concat(t.photoUrl,'" \n          alt="Gambar cerita ').concat(t.name,'" \n          class="story-image" \n          loading="lazy"\n        />\n        <h3 class="story-name">').concat(t.name,'</h3>\n        <p class="story-description">').concat(t.description,'</p>\n        <p class="story-date">').concat(new Date(t.createdAt).toLocaleString("id-ID"),'</p>\n        <div class="story-actions">\n          <button class="detail-button" data-id="').concat(t.id,'" aria-label="Lihat detail cerita ').concat(t.name,'">\n            üìñ Lihat Detail\n          </button>\n          <button class="save-fav" data-id="').concat(t.id,'" aria-label="Simpan cerita ').concat(t.name,'">\n            üíæ Simpan Story\n          </button>\n        </div>\n      </article>\n    ')})).join(""),this.bindSaveFavorite(t)):this.container.innerHTML='\n        <p class="no-stories" tabindex="0">Tidak ada cerita yang tersedia.</p>\n      ')}},{key:"bindAddStoryForm",value:function(t){var e=document.querySelector("#addStoryForm");e&&e.addEventListener("submit",(function(n){n.preventDefault();var r=new FormData(e);t(r)}))}},{key:"bindDetailButton",value:function(t,e){var n=this,r=document.getElementById("detailModal"),o=document.getElementById("modal-content"),i=document.getElementById("closeModal");r&&o?(document.querySelectorAll(".detail-button").forEach((function(e){e.addEventListener("click",(function(){var i=e.dataset.id,a=t.find((function(t){return t.id===i}));if(a){o.innerHTML='\n          <div class="modal-content-wrapper">\n            <span id="closeModalInner" class="close-button">&times;</span>\n            <img src="'.concat(a.photoUrl,'" alt="').concat(a.name,'" class="modal-image" />\n            <h3>').concat(a.name,'</h3>\n            <p class="modal-description">').concat(a.description,"</p>\n            ").concat(a.lat&&a.lon?'<button \n                    id="focusMapBtn" \n                    class="focus-map-btn" \n                    data-lat="'.concat(a.lat,'" \n                    data-lon="').concat(a.lon,'">\n                    üìç Lihat Lokasi di Peta\n                   </button>'):"<p><em>Tidak ada lokasi</em></p>","\n          </div>\n        "),r.style.display="flex",document.body.style.overflow="hidden";var c=document.getElementById("closeModalInner");c&&c.addEventListener("click",(function(){return n.hideModal()}));var u=document.getElementById("focusMapBtn");u&&u.addEventListener("click",(function(){var t=parseFloat(u.dataset.lat),e=parseFloat(u.dataset.lon);n.hideModal();var r="https://www.google.com/maps?q=".concat(t,",").concat(e);window.open(r,"_blank")}))}}))})),i&&i.addEventListener("click",(function(){return n.hideModal()})),window.addEventListener("click",(function(t){t.target===r&&n.hideModal()}))):console.warn("‚ö†Ô∏è Elemen modal belum ditemukan di DOM.")}},{key:"bindSaveFavorite",value:function(t){document.querySelectorAll(".save-fav").forEach((function(e){e.addEventListener("click",_(P().m((function n(){var r,o,i,a,c;return P().w((function(n){for(;;)switch(n.n){case 0:if(r=e.dataset.id,o=t.find((function(t){return t.id===r}))){n.n=1;break}return n.a(2);case 1:return i="favorites",a=function(){return new Promise((function(t,e){var n=indexedDB.open("story-favorites-db",1);n.onupgradeneeded=function(t){var e=t.target.result;e.objectStoreNames.contains(i)||e.createObjectStore(i,{keyPath:"id"})},n.onsuccess=function(e){return t(e.target.result)},n.onerror=function(t){return e(t.target.error)}}))},c=function(){var t=_(P().m((function t(e){var n,r;return P().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,a();case 1:return n=t.v,(r=n.transaction(i,"readwrite")).objectStore(i).put(e),t.a(2,new Promise((function(t){r.oncomplete=function(){return t(!0)}})))}}),t)})));return function(e){return t.apply(this,arguments)}}(),n.n=2,c(o);case 2:alert("‚úÖ Cerita disimpan ke favorit!");case 3:return n.a(2)}}),n)}))))}))}},{key:"hideModal",value:function(){var t=document.getElementById("detailModal");t&&(t.style.display="none"),document.body.style.overflow="auto"}}],e&&G(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function F(t){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},F(t)}function B(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return I(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(I(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,I(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,I(f,"constructor",s),I(s,"constructor",u),u.displayName="GeneratorFunction",I(s,o,"GeneratorFunction"),I(f),I(f,o,"Generator"),I(f,r,(function(){return this})),I(f,"toString",(function(){return"[object Generator]"})),(B=function(){return{w:i,m:p}})()}function I(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}I=function(t,e,n,r){function i(e,n){I(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},I(t,e,n,r)}function A(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function C(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){A(i,r,o,a,c,"next",t)}function c(t){A(i,r,o,a,c,"throw",t)}a(void 0)}))}}function N(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,D(r.key),r)}}function D(t){var e=function(t){if("object"!=F(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=F(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==F(e)?e:e+""}const q=function(){return t=function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.model=e,this.view=n,this.map=null,this.markers=[]},e=[{key:"init",value:(i=C(B().m((function t(){var e;return B().w((function(t){for(;;)switch(t.n){case 0:if(localStorage.getItem("token")){t.n=1;break}return alert("Sesi login telah berakhir. Silakan login kembali."),window.location.hash="#/login",t.a(2);case 1:return t.n=2,this.showStories();case 2:e=t.v,this.initMap(),this.updateMapMarkers(e);case 3:return t.a(2)}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"showStories",value:(o=C(B().m((function t(){var e,n,r=this;return B().w((function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,this.view.showLoading(),t.n=1,this.model.getStories();case 1:return e=t.v,this.view.displayStories(e),this.stories=e,this.view.bindDetailButton(e,(function(t,e){r.map&&t&&e?(r.map.setView([t,e],15),L.marker([t,e]).addTo(r.map).bindPopup("Lokasi Cerita").openPopup(),setTimeout((function(){return r.map.flyTo([t,e],15,{duration:1.5})}),100)):console.warn("‚ùå Peta belum siap atau koordinat tidak valid")})),this.view.bindSaveFavorite(e,function(){var t=C(B().m((function t(e){var n;return B().w((function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,r.model.saveFavorite(e);case 1:alert('Story "'.concat(e.name,'" telah disimpan ke favorit!')),t.n=3;break;case 2:t.p=2,n=t.v,console.error("Gagal menyimpan story:",n),alert("‚ùå Terjadi kesalahan saat menyimpan story.");case 3:return t.a(2)}}),t,null,[[0,2]])})));return function(e){return t.apply(this,arguments)}}()),t.a(2,e);case 2:return t.p=2,n=t.v,console.error(n),this.view.showError(n.message),t.a(2,[]);case 3:return t.p=3,this.view.hideLoading(),t.f(3);case 4:return t.a(2)}}),t,this,[[0,2,3,4]])}))),function(){return o.apply(this,arguments)})},{key:"initMap",value:function(){if(document.getElementById("map")){this.map=L.map("map").setView([-2.5489,118.0149],5);var t=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"¬© OpenStreetMap contributors"}),e=L.tileLayer("https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",{attribution:"¬© Google Satellite",subdomains:["mt0","mt1","mt2","mt3"]});t.addTo(this.map),L.control.layers({"Street Map":t,Satellite:e}).addTo(this.map)}}},{key:"updateMapMarkers",value:function(t){var e=this;this.map&&(this.markers.forEach((function(t){return e.map.removeLayer(t)})),this.markers=[],t.forEach((function(t){if(t.lat&&t.lon){var n=L.marker([t.lat,t.lon]).addTo(e.map).bindPopup('\n            <div class="popup-content">\n              <img src="'.concat(t.photoUrl,'" alt="').concat(t.description,'" \n                   style="width: 100px; height: 100px; object-fit: cover;">\n              <h4>').concat(t.name,"</h4>\n              <p>").concat(t.description,"</p>\n            </div>\n          "));e.markers.push(n)}})))}},{key:"addStory",value:(r=C(B().m((function t(e){var n,r,o;return B().w((function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,this.model.addStory(e);case 1:if(!1!==(n=t.v).error){t.n=3;break}return t.n=2,this.showStories();case 2:return r=t.v,this.updateMapMarkers(r),t.a(2,{success:!0,message:n.message});case 3:throw new Error(n.message||"Gagal menambahkan cerita");case 4:t.n=6;break;case 5:return t.p=5,o=t.v,console.error("Gagal menambahkan cerita:",o),t.a(2,{success:!1,message:o.message});case 6:return t.a(2)}}),t,this,[[0,5]])}))),function(t){return r.apply(this,arguments)})},{key:"handleAddStory",value:(n=C(B().m((function t(e){var n,r;return B().w((function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,this.view.showLoading(),t.n=1,this.model.addStory(e);case 1:if(!1!==(n=t.v).error){t.n=3;break}return this.view.showMessage("Cerita berhasil ditambahkan!"),t.n=2,this.showStories();case 2:r=t.v,this.updateMapMarkers(r),t.n=4;break;case 3:this.view.showError(n.message);case 4:t.n=6;break;case 5:t.p=5,t.v,this.view.showError("Gagal menambahkan cerita!");case 6:return t.p=6,this.view.hideLoading(),t.f(6);case 7:return t.a(2)}}),t,this,[[0,5,6,7]])}))),function(t){return n.apply(this,arguments)})}],e&&N(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,o,i}();function H(t){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},H(t)}function W(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return z(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(z(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,z(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,z(f,"constructor",s),z(s,"constructor",u),u.displayName="GeneratorFunction",z(s,o,"GeneratorFunction"),z(f),z(f,o,"Generator"),z(f,r,(function(){return this})),z(f,"toString",(function(){return"[object Generator]"})),(W=function(){return{w:i,m:p}})()}function z(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}z=function(t,e,n,r){function i(e,n){z(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},z(t,e,n,r)}function R(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function U(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){R(i,r,o,a,c,"next",t)}function c(t){R(i,r,o,a,c,"throw",t)}a(void 0)}))}}function V(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,J(r.key),r)}}function J(t){var e=function(t){if("object"!=H(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=H(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==H(e)?e:e+""}var K=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.model=new j,this.view=new M,this.presenter=new q(this.model,this.view)},e=[{key:"render",value:(r=U(W().m((function t(){return W().w((function(t){for(;;)if(0===t.n)return t.a(2,'\n    <section class="container">\n      <a href="#main-content" class="skip-link">Skip to content</a>\n      <h1 tabindex="0">Cerita Masyarakat</h1>\n      <div id="loading" class="loading" aria-live="polite" style="display: none;">Memuat data...</div>\n      \n      <div class="content-layout">\n        <aside class="stories-sidebar" aria-label="Daftar cerita pengguna">\n          <h2 tabindex="0">Daftar Cerita</h2>\n          <div id="stories-container" class="stories-container"></div>\n        </aside>\n        \n        <main class="map-container" aria-label="Peta lokasi cerita">\n          <h2 tabindex="0">Peta Lokasi</h2>\n          <div id="map" class="map"></div>\n        </main>\n      </div>\n\n      <div id="detailModal" class="modal" role="dialog" aria-modal="true" style="display:none;">\n        <div class="modal-content-wrapper">\n          <span id="closeModal" class="close-button" aria-label="Tutup popup">&times;</span>\n          <div id="modal-content"></div>\n        </div>\n      </div>\n\n      <div class="floating-action">\n        <a href="#/add-story" class="fab" aria-label="Tambah cerita baru">+</a>\n      </div>\n    </section>\n  ')}),t)}))),function(){return r.apply(this,arguments)})},{key:"afterRender",value:(n=U(W().m((function t(){var e=this;return W().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,this.loadLeaflet();case 1:return this.view.bindElements(),t.n=2,this.presenter.init();case 2:setTimeout((function(){var t;document.querySelectorAll(".detail-button").length>0&&null!==(t=e.presenter.stories)&&void 0!==t&&t.length?e.view.bindDetailButton(e.presenter.stories,(function(t,n){if(e.presenter.map&&t&&n){e.presenter.map.setView([t,n],14);var r=e.presenter.markers.find((function(e){return e.getLatLng().lat===t&&e.getLatLng().lng===n}));r&&r.openPopup()}})):console.warn("‚ö†Ô∏è Tidak ditemukan tombol detail di DOM.")}),500),this.setupInteractions();case 3:return t.a(2)}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"loadLeaflet",value:function(){return new Promise((function(t){var e=document.createElement("link");e.rel="stylesheet",e.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(e);var n=document.createElement("script");n.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",n.onload=t,document.head.appendChild(n)}))}},{key:"setupInteractions",value:function(){var t=this;document.addEventListener("mouseover",(function(e){if(e.target.closest(".story-card")){var n=e.target.closest(".story-card").dataset.id,r=t.presenter.markers.find((function(t){return t._popup&&t._popup._content.includes('"'.concat(n,'"'))}));r&&r.openPopup()}}))}}],e&&V(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();function Y(t){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y(t)}function Q(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return $(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):($(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,$(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,$(f,"constructor",s),$(s,"constructor",u),u.displayName="GeneratorFunction",$(s,o,"GeneratorFunction"),$(f),$(f,o,"Generator"),$(f,r,(function(){return this})),$(f,"toString",(function(){return"[object Generator]"})),(Q=function(){return{w:i,m:p}})()}function $(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}$=function(t,e,n,r){function i(e,n){$(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},$(t,e,n,r)}function X(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function Z(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){X(i,r,o,a,c,"next",t)}function c(t){X(i,r,o,a,c,"throw",t)}a(void 0)}))}}function tt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,et(r.key),r)}}function et(t){var e=function(t){if("object"!=Y(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Y(e)?e:e+""}var nt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"render",value:(r=Z(Q().m((function t(){return Q().w((function(t){for(;;)if(0===t.n)return t.a(2,'\n      <section class="container">\n        <a href="#main-content" class="skip-link">Skip to content</a>\n        <h1 tabindex="0">Tentang Aplikasi</h1>\n        \n        <article class="about-content">\n          <h2>Cerita Masyarakat</h2>\n          <p>Aplikasi ini dibuat untuk berbagi cerita dan pengalaman masyarakat dari berbagai lokasi di Indonesia.</p>\n          \n          <h3>Fitur Utama:</h3>\n          <ul>\n            <li>üìñ Membaca cerita dari berbagai daerah</li>\n            <li>üó∫Ô∏è Melihat lokasi cerita di peta interaktif</li>\n            <li>üìù Menambahkan cerita baru dengan foto</li>\n            <li>üì∑ Mengambil foto langsung dari kamera</li>\n            <li>üéØ Multiple layer peta (Street dan Satellite)</li>\n          </ul>\n          \n          <h3>Teknologi yang Digunakan:</h3>\n          <ul>\n            <li>JavaScript ES6+</li>\n            <li>Leaflet.js untuk peta</li>\n            <li>MVP Architecture</li>\n            <li>Webpack</li>\n            <li>Dicoding Story API</li>\n          </ul>\n        </article>\n      </section>\n    ')}),t)}))),function(){return r.apply(this,arguments)})},{key:"afterRender",value:(n=Z(Q().m((function t(){return Q().w((function(t){for(;;)switch(t.n){case 0:document.querySelectorAll("h1, h2, h3").forEach((function(t){t.setAttribute("tabindex","0")}));case 1:return t.a(2)}}),t)}))),function(){return n.apply(this,arguments)})}],e&&tt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();function rt(t){return rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rt(t)}function ot(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return it(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(it(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,it(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,it(f,"constructor",s),it(s,"constructor",u),u.displayName="GeneratorFunction",it(s,o,"GeneratorFunction"),it(f),it(f,o,"Generator"),it(f,r,(function(){return this})),it(f,"toString",(function(){return"[object Generator]"})),(ot=function(){return{w:i,m:p}})()}function it(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}it=function(t,e,n,r){function i(e,n){it(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},it(t,e,n,r)}function at(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function ct(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ut(r.key),r)}}function ut(t){var e=function(t){if("object"!=rt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=rt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==rt(e)?e:e+""}var st=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.stream=null},e=[{key:"startCamera",value:(n=ot().m((function t(e){return ot().w((function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});case 1:return this.stream=t.v,e.srcObject=this.stream,t.n=2,e.play();case 2:t.n=4;break;case 3:throw t.p=3,t.v,new Error("Tidak dapat mengakses kamera. Pastikan Anda memberikan izin akses kamera.");case 4:return t.a(2)}}),t,this,[[0,3]])})),r=function(){var t=this,e=arguments;return new Promise((function(r,o){var i=n.apply(t,e);function a(t){at(i,r,o,a,c,"next",t)}function c(t){at(i,r,o,a,c,"throw",t)}a(void 0)}))},function(t){return r.apply(this,arguments)})},{key:"capturePhoto",value:function(t){if(!this.stream)throw new Error("Kamera belum diaktifkan");var e=document.getElementById("camera-capture"),n=e.getContext("2d");return e.width=t.videoWidth,e.height=t.videoHeight,n.drawImage(t,0,0,e.width,e.height),new Promise((function(t){e.toBlob((function(e){var n=new File([e],"camera-photo.jpg",{type:"image/jpeg",lastModified:Date.now()});t(n)}),"image/jpeg",.8)}))}},{key:"stopCamera",value:function(){this.stream&&(this.stream.getTracks().forEach((function(t){return t.stop()})),this.stream=null)}}],e&&ct(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();function lt(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return ft(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(ft(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,ft(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,ft(f,"constructor",s),ft(s,"constructor",u),u.displayName="GeneratorFunction",ft(s,o,"GeneratorFunction"),ft(f),ft(f,o,"Generator"),ft(f,r,(function(){return this})),ft(f,"toString",(function(){return"[object Generator]"})),(lt=function(){return{w:i,m:p}})()}function ft(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}ft=function(t,e,n,r){function i(e,n){ft(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},ft(t,e,n,r)}function pt(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function dt(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){pt(i,r,o,a,c,"next",t)}function c(t){pt(i,r,o,a,c,"throw",t)}a(void 0)}))}}var vt="pending-stories";function yt(){return new Promise((function(t,e){var n=indexedDB.open("story-sync-db",1);n.onupgradeneeded=function(t){var e=t.target.result;e.objectStoreNames.contains(vt)||e.createObjectStore(vt,{keyPath:"createdAt"})},n.onsuccess=function(e){return t(e.target.result)},n.onerror=function(t){return e(t.target.error)}}))}function mt(t){return ht.apply(this,arguments)}function ht(){return(ht=dt(lt().m((function t(e){var n;return lt().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,yt();case 1:return n=t.v,t.a(2,new Promise((function(t,r){var o=n.transaction(vt,"readwrite");o.objectStore(vt).put(e),o.oncomplete=function(){return t()},o.onerror=function(t){return r(t)}})))}}),t)})))).apply(this,arguments)}function bt(){return gt.apply(this,arguments)}function gt(){return(gt=dt(lt().m((function t(){var e;return lt().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,yt();case 1:return e=t.v,t.a(2,new Promise((function(t,n){var r=e.transaction(vt,"readonly").objectStore(vt).getAll();r.onsuccess=function(){return t(r.result)},r.onerror=function(t){return n(t)}})))}}),t)})))).apply(this,arguments)}function wt(t){return kt.apply(this,arguments)}function kt(){return(kt=dt(lt().m((function t(e){var n;return lt().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,yt();case 1:return n=t.v,t.a(2,new Promise((function(t,r){var o=n.transaction(vt,"readwrite");o.objectStore(vt).delete(e),o.oncomplete=function(){return t()},o.onerror=function(t){return r(t)}})))}}),t)})))).apply(this,arguments)}function St(t){return St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},St(t)}function jt(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return Ot(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(Ot(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,Ot(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,Ot(f,"constructor",s),Ot(s,"constructor",u),u.displayName="GeneratorFunction",Ot(s,o,"GeneratorFunction"),Ot(f),Ot(f,o,"Generator"),Ot(f,r,(function(){return this})),Ot(f,"toString",(function(){return"[object Generator]"})),(jt=function(){return{w:i,m:p}})()}function Ot(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Ot=function(t,e,n,r){function i(e,n){Ot(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Ot(t,e,n,r)}function Pt(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function Et(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Pt(i,r,o,a,c,"next",t)}function c(t){Pt(i,r,o,a,c,"throw",t)}a(void 0)}))}}function Tt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_t(r.key),r)}}function _t(t){var e=function(t){if("object"!=St(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=St(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==St(e)?e:e+""}var Gt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.model=new j,this.view=new M,this.presenter=new q(this.model,this.view),this.camera=new st,this.selectedLocation=null,this.map=null},e=[{key:"render",value:(i=Et(jt().m((function t(){return jt().w((function(t){for(;;)if(0===t.n)return t.a(2,'\n      <section class="container">\n        <a href="#main-content" class="skip-link">Skip to content</a>\n        <h1 tabindex="0">Tambah Cerita Baru</h1>\n        \n        <form id="add-story-form" class="story-form">\n          <div class="form-group">\n            <label for="description">Deskripsi Cerita:</label>\n            <textarea id="description" name="description" required aria-required="true" rows="4"></textarea>\n            <span class="error-message" id="description-error"></span>\n          </div>\n\n          <div class="form-group">\n            <label for="photo">Foto:</label>\n            <input type="file" id="photo" name="photo" accept="image/*" required aria-required="true">\n            <span class="error-message" id="photo-error"></span>\n            \n            <div class="camera-options">\n              <button type="button" id="camera-btn" class="camera-btn">Ambil Foto dari Kamera</button>\n              <video id="camera-preview" style="display:none" aria-label="Preview kamera"></video>\n              <canvas id="camera-capture" style="display:none"></canvas>\n              <button type="button" id="capture-btn" style="display:none" class="capture-btn">Ambil Foto</button>\n            </div>\n\n            <div id="image-preview" class="image-preview"></div>\n          </div>\n\n          <div class="form-group">\n            <label>Pilih Lokasi di Peta:</label>\n            <div id="location-map" class="location-map"></div>\n            <p id="selected-location" class="location-info">Belum memilih lokasi</p>\n          </div>\n\n          <button type="submit" class="submit-btn">Tambah Cerita</button>\n          <div id="form-message" class="form-message"></div>\n        </form>\n      </section>\n    ')}),t)}))),function(){return i.apply(this,arguments)})},{key:"afterRender",value:(o=Et(jt().m((function t(){return jt().w((function(t){for(;;)switch(t.n){case 0:if(localStorage.getItem("token")||(alert("Anda harus login terlebih dahulu!"),window.location.hash="#/login",0)){t.n=1;break}return t.a(2);case 1:return t.n=2,this.loadLeaflet();case 2:this.initMap(),this.setupFormValidation(),this.setupCamera();case 3:return t.a(2)}}),t,this)}))),function(){return o.apply(this,arguments)})},{key:"loadLeaflet",value:function(){return new Promise((function(t){if(window.L)return t();var e=document.createElement("link");e.rel="stylesheet",e.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(e);var n=document.createElement("script");n.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",n.onload=t,document.head.appendChild(n)}))}},{key:"initMap",value:function(){var t=this;this.map=L.map("location-map").setView([-2.5489,118.0149],5),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"¬© OpenStreetMap contributors"}).addTo(this.map),this.map.on("click",(function(e){t.selectedLocation=e.latlng,t.locationMarker&&t.map.removeLayer(t.locationMarker),t.locationMarker=L.marker(e.latlng).addTo(t.map).bindPopup("Lokasi terpilih").openPopup(),document.getElementById("selected-location").textContent="Lokasi terpilih: ".concat(e.latlng.lat.toFixed(4),", ").concat(e.latlng.lng.toFixed(4)),document.getElementById("selected-location").style.color=""}))}},{key:"setupFormValidation",value:function(){var t=this,e=document.getElementById("add-story-form"),n=document.getElementById("description"),r=document.getElementById("photo");n.addEventListener("input",(function(){t.validateField(n,"description-error","Deskripsi harus diisi")})),r.addEventListener("change",(function(e){t.validatePhoto(e.target)})),e.addEventListener("submit",function(){var e=Et(jt().m((function e(n){return jt().w((function(e){for(;;)switch(e.n){case 0:return n.preventDefault(),e.n=1,t.validateForm();case 1:if(!e.v){e.n=2;break}return e.n=2,t.submitForm();case 2:return e.a(2)}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"validateField",value:function(t,e,n){var r=document.getElementById(e);return t.value.trim()?(r.textContent="",t.setAttribute("aria-invalid","false"),!0):(r.textContent=n,t.setAttribute("aria-invalid","true"),!1)}},{key:"validatePhoto",value:function(t){var e=document.getElementById("photo-error");if(t.files&&0!==t.files.length){e.textContent="",t.setAttribute("aria-invalid","false");var n=t.files[0],r=new FileReader;return r.onload=function(t){document.getElementById("image-preview").innerHTML='\n          <img src="'.concat(t.target.result,'" alt="Preview foto" class="preview-image">\n        ')},r.readAsDataURL(n),!0}return e.textContent="Foto harus dipilih",t.setAttribute("aria-invalid","true"),!1}},{key:"validateForm",value:(r=Et(jt().m((function t(){var e,n;return jt().w((function(t){for(;;)switch(t.n){case 0:if(e=this.validateField(document.getElementById("description"),"description-error","Deskripsi harus diisi"),n=this.validatePhoto(document.getElementById("photo")),this.selectedLocation){t.n=1;break}return document.getElementById("selected-location").style.color="red",t.a(2,!1);case 1:return t.a(2,e&&n)}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"setupCamera",value:function(){var t=this,e=document.getElementById("camera-btn"),n=document.getElementById("camera-preview"),r=document.getElementById("capture-btn"),o=document.getElementById("photo"),i=document.createElement("button");i.textContent="Batalkan Kamera",i.type="button",i.className="cancel-btn",i.style.display="none",e.parentNode.insertBefore(i,n.nextSibling),e.addEventListener("click",Et(jt().m((function o(){var a;return jt().w((function(o){for(;;)switch(o.p=o.n){case 0:return o.p=0,o.n=1,t.camera.startCamera(n);case 1:n.style.display="block",r.style.display="block",i.style.display="block",e.style.display="none",o.n=3;break;case 2:o.p=2,a=o.v,t.showMessage("Tidak dapat mengakses kamera: "+a.message,"error");case 3:return o.a(2)}}),o,null,[[0,2]])})))),r.addEventListener("click",Et(jt().m((function a(){var c,u,s;return jt().w((function(a){for(;;)switch(a.p=a.n){case 0:return a.p=0,a.n=1,t.camera.capturePhoto(n);case 1:(c=a.v)instanceof File&&((u=new DataTransfer).items.add(c),o.files=u.files,o.dispatchEvent(new Event("change"))),t.camera.stopCamera(),n.style.display="none",r.style.display="none",i.style.display="none",e.style.display="block",a.n=3;break;case 2:a.p=2,s=a.v,t.showMessage("Gagal mengambil foto: "+s.message,"error");case 3:return a.a(2)}}),a,null,[[0,2]])})))),i.addEventListener("click",(function(){t.camera.stopCamera(),n.style.display="none",r.style.display="none",i.style.display="none",e.style.display="block"}))}},{key:"submitForm",value:(n=Et(jt().m((function t(){var e,n,r,o,i,a,c,u,s,l,f,p,d;return jt().w((function(t){for(;;)switch(t.p=t.n){case 0:if(e=document.getElementById("add-story-form"),n=e.querySelector(".submit-btn"),r=document.getElementById("form-message"),o=localStorage.getItem("token")){t.n=1;break}return this.showMessage("Token tidak ditemukan. Silakan login ulang.","error"),window.location.hash="#/login",t.a(2);case 1:return t.p=1,n.disabled=!0,n.textContent="Mengirim...",r.textContent="",(i=new FormData).append("description",document.getElementById("description").value),i.append("photo",document.getElementById("photo").files[0]),this.selectedLocation&&(i.append("lat",this.selectedLocation.lat),i.append("lon",this.selectedLocation.lng)),t.n=2,this.presenter.addStory(i);case 2:if(!(a=t.v).success){t.n=3;break}this.showMessage("Cerita berhasil ditambahkan!","success"),e.reset(),document.getElementById("image-preview").innerHTML="",setTimeout((function(){return window.location.hash="#/"}),2e3),t.n=4;break;case 3:throw new Error(a.message);case 4:t.n=9;break;case 5:return t.p=5,d=t.v,console.warn("üì¥ Offline: menyimpan cerita ke pending DB",d),s=document.getElementById("photo").files[0],l=URL.createObjectURL(s),f={description:document.getElementById("description").value,photoUrl:l,lat:null===(c=this.selectedLocation)||void 0===c?void 0:c.lat,lon:null===(u=this.selectedLocation)||void 0===u?void 0:u.lng,createdAt:(new Date).toISOString()},t.n=6,mt(f);case 6:if(this.showMessage("üì¥ Offline: cerita disimpan dan akan dikirim saat online!","warning"),navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"SET_TOKEN",token:o}),!("serviceWorker"in navigator)||!("SyncManager"in window)){t.n=9;break}return t.n=7,navigator.serviceWorker.ready;case 7:return p=t.v,t.n=8,p.sync.register("sync-stories");case 8:console.log("üì° Cerita offline akan disinkronkan nanti.");case 9:return t.p=9,n.disabled=!1,n.textContent="Tambah Cerita",t.f(9);case 10:return t.a(2)}}),t,this,[[1,5,9,10]])}))),function(){return n.apply(this,arguments)})},{key:"showMessage",value:function(t,e){var n=document.getElementById("form-message");n.textContent=t,n.className="form-message ".concat(e)}}],e&&Tt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,o,i}();function Lt(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return xt(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(xt(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,xt(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,xt(f,"constructor",s),xt(s,"constructor",u),u.displayName="GeneratorFunction",xt(s,o,"GeneratorFunction"),xt(f),xt(f,o,"Generator"),xt(f,r,(function(){return this})),xt(f,"toString",(function(){return"[object Generator]"})),(Lt=function(){return{w:i,m:p}})()}function xt(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}xt=function(t,e,n,r){function i(e,n){xt(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},xt(t,e,n,r)}function Mt(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function Ft(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Mt(i,r,o,a,c,"next",t)}function c(t){Mt(i,r,o,a,c,"throw",t)}a(void 0)}))}}const Bt=function(t){return Ft(Lt().m((function e(){var n,r,o,i,a,c,u,s;return Lt().w((function(e){for(;;)switch(e.p=e.n){case 0:return n=t.email,r=t.password,e.p=1,e.n=2,fetch("https://story-api.dicoding.dev/v1/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,password:r})});case 2:return c=e.v,e.n=3,c.json();case 3:if(u=e.v,c.ok&&!u.error){e.n=4;break}throw new Error(u.message||"Login gagal, periksa email dan password.");case 4:return e.a(2,{token:null===(o=u.loginResult)||void 0===o?void 0:o.token,name:null===(i=u.loginResult)||void 0===i?void 0:i.name,userId:null===(a=u.loginResult)||void 0===a?void 0:a.userId});case 5:throw e.p=5,s=e.v,new Error("Gagal menghubungi server: ".concat(s.message));case 6:return e.a(2)}}),e,null,[[1,5]])})))()},It=function(t){return Ft(Lt().m((function e(){var n,r,o,i,a;return Lt().w((function(e){for(;;)switch(e.n){case 0:return n=t.name,r=t.email,o=t.password,e.n=1,fetch("https://story-api.dicoding.dev/v1/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,email:r,password:o})});case 1:return i=e.v,e.n=2,i.json();case 2:if(a=e.v,i.ok&&!a.error){e.n=3;break}throw new Error(a.message||"Registrasi gagal, periksa data Anda.");case 3:return e.a(2,a)}}),e)})))()};function At(t){return At="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},At(t)}function Ct(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return Nt(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(Nt(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,Nt(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,Nt(f,"constructor",s),Nt(s,"constructor",u),u.displayName="GeneratorFunction",Nt(s,o,"GeneratorFunction"),Nt(f),Nt(f,o,"Generator"),Nt(f,r,(function(){return this})),Nt(f,"toString",(function(){return"[object Generator]"})),(Ct=function(){return{w:i,m:p}})()}function Nt(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Nt=function(t,e,n,r){function i(e,n){Nt(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Nt(t,e,n,r)}function Dt(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function qt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ht(r.key),r)}}function Ht(t){var e=function(t){if("object"!=At(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=At(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==At(e)?e:e+""}var Wt=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.view=e},e=[{key:"login",value:(n=Ct().m((function t(e){var n,r,o,i,c=this;return Ct().w((function(t){for(;;)switch(t.p=t.n){case 0:if(n=e.email,r=e.password,n&&r){t.n=1;break}return this.view.showMessage("Email dan kata sandi wajib diisi.",!0),t.a(2);case 1:return this.view.showMessage("Memproses login..."),t.p=2,t.n=3,Bt({email:n,password:r});case 3:if(o=t.v,console.log("Hasil dari AuthModel.login():",o),o&&o.token){t.n=4;break}throw new Error("Token tidak ditemukan di respons API");case 4:a.saveSession(o),this.view.showMessage("Login berhasil! Mengalihkan..."),setTimeout((function(){return c.view.redirectToHome()}),1500),t.n=6;break;case 5:t.p=5,i=t.v,console.error("Login error:",i),this.view.showMessage("Login gagal: ".concat(i.message),!0);case 6:return t.a(2)}}),t,this,[[2,5]])})),r=function(){var t=this,e=arguments;return new Promise((function(r,o){var i=n.apply(t,e);function a(t){Dt(i,r,o,a,c,"next",t)}function c(t){Dt(i,r,o,a,c,"throw",t)}a(void 0)}))},function(t){return r.apply(this,arguments)})}],e&&qt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();function zt(t){return zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zt(t)}function Rt(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return Ut(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(Ut(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,Ut(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,Ut(f,"constructor",s),Ut(s,"constructor",u),u.displayName="GeneratorFunction",Ut(s,o,"GeneratorFunction"),Ut(f),Ut(f,o,"Generator"),Ut(f,r,(function(){return this})),Ut(f,"toString",(function(){return"[object Generator]"})),(Rt=function(){return{w:i,m:p}})()}function Ut(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Ut=function(t,e,n,r){function i(e,n){Ut(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Ut(t,e,n,r)}function Vt(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function Jt(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Vt(i,r,o,a,c,"next",t)}function c(t){Vt(i,r,o,a,c,"throw",t)}a(void 0)}))}}function Kt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Yt(r.key),r)}}function Yt(t){var e=function(t){if("object"!=zt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=zt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==zt(e)?e:e+""}var Qt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"render",value:(r=Jt(Rt().m((function t(){return Rt().w((function(t){for(;;)if(0===t.n)return t.a(2,'\n      <section class="login-container">\n        <div class="login-card">\n          <img src="./images/logo.png" alt="Logo Aplikasi" class="login-logo" />\n\n          <h1 tabindex="0">Masuk ke Akun Anda</h1>\n\n          <form id="login-form" class="login-form" role="form">\n            <div class="form-group">\n              <label for="email">Email</label>\n              <input \n                type="email" \n                id="email" \n                name="email" \n                required \n                aria-required="true"\n                placeholder="Masukkan email Anda" \n              />\n            </div>\n\n            <div class="form-group">\n              <label for="password">Kata Sandi</label>\n              <input \n                type="password" \n                id="password" \n                name="password" \n                required \n                aria-required="true"\n                placeholder="Masukkan kata sandi" \n              />\n            </div>\n\n            <button type="submit" class="login-btn">Masuk</button>\n            <p id="login-message" class="login-message" aria-live="polite"></p>\n          </form>\n\n          <p class="login-switch">\n            Belum punya akun?\n            <a href="#/register">Daftar di sini</a>\n          </p>\n        </div>\n      </section>\n    ')}),t)}))),function(){return r.apply(this,arguments)})},{key:"afterRender",value:(n=Jt(Rt().m((function t(){var e,n;return Rt().w((function(t){for(;;)switch(t.n){case 0:e=document.getElementById("login-form"),n=new Wt(this),e.addEventListener("submit",function(){var t=Jt(Rt().m((function t(e){var r,o;return Rt().w((function(t){for(;;)switch(t.n){case 0:return e.preventDefault(),r=document.getElementById("email").value.trim(),o=document.getElementById("password").value.trim(),t.n=1,n.login({email:r,password:o});case 1:return t.a(2)}}),t)})));return function(e){return t.apply(this,arguments)}}());case 1:return t.a(2)}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"showMessage",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.getElementById("login-message");n.textContent=t,n.className="login-message ".concat(e?"error":"success")}},{key:"redirectToHome",value:function(){window.location.hash="#/"}}],e&&Kt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();function $t(t){return $t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$t(t)}function Xt(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return Zt(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(Zt(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,Zt(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,Zt(f,"constructor",s),Zt(s,"constructor",u),u.displayName="GeneratorFunction",Zt(s,o,"GeneratorFunction"),Zt(f),Zt(f,o,"Generator"),Zt(f,r,(function(){return this})),Zt(f,"toString",(function(){return"[object Generator]"})),(Xt=function(){return{w:i,m:p}})()}function Zt(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Zt=function(t,e,n,r){function i(e,n){Zt(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Zt(t,e,n,r)}function te(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function ee(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ne(r.key),r)}}function ne(t){var e=function(t){if("object"!=$t(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=$t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==$t(e)?e:e+""}var re=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.view=e},e=[{key:"register",value:(n=Xt().m((function t(e){var n,r,o,i,a,c=this;return Xt().w((function(t){for(;;)switch(t.p=t.n){case 0:if(n=e.name,r=e.email,o=e.password,n&&r&&o){t.n=1;break}return this.view.showMessage("Semua kolom wajib diisi.",!0),t.a(2);case 1:if(!(o.length<8)){t.n=2;break}return this.view.showMessage("Kata sandi minimal 8 karakter.",!0),t.a(2);case 2:return this.view.showMessage("Memproses registrasi..."),t.p=3,t.n=4,It({name:n,email:r,password:o});case 4:i=t.v,console.log("Hasil register:",i),this.view.showMessage("Registrasi berhasil! Silakan login."),setTimeout((function(){return c.view.redirectToLogin()}),2e3),t.n=6;break;case 5:t.p=5,a=t.v,console.error("Register error:",a),a.message.includes("Email is already taken")?this.view.showMessage("Email sudah digunakan, silakan pakai email lain.",!0):this.view.showMessage("Registrasi gagal: ".concat(a.message),!0);case 6:return t.a(2)}}),t,this,[[3,5]])})),r=function(){var t=this,e=arguments;return new Promise((function(r,o){var i=n.apply(t,e);function a(t){te(i,r,o,a,c,"next",t)}function c(t){te(i,r,o,a,c,"throw",t)}a(void 0)}))},function(t){return r.apply(this,arguments)})}],e&&ee(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();function oe(t){return oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},oe(t)}function ie(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return ae(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(ae(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,ae(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,ae(f,"constructor",s),ae(s,"constructor",u),u.displayName="GeneratorFunction",ae(s,o,"GeneratorFunction"),ae(f),ae(f,o,"Generator"),ae(f,r,(function(){return this})),ae(f,"toString",(function(){return"[object Generator]"})),(ie=function(){return{w:i,m:p}})()}function ae(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}ae=function(t,e,n,r){function i(e,n){ae(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},ae(t,e,n,r)}function ce(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function ue(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){ce(i,r,o,a,c,"next",t)}function c(t){ce(i,r,o,a,c,"throw",t)}a(void 0)}))}}function se(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,le(r.key),r)}}function le(t){var e=function(t){if("object"!=oe(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=oe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==oe(e)?e:e+""}var fe=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"render",value:(r=ue(ie().m((function t(){return ie().w((function(t){for(;;)if(0===t.n)return t.a(2,'\n      <section class="login-container">\n        <div class="login-card">\n          <img src="./images/logo.png" alt="Logo Aplikasi" class="login-logo" />\n\n          <h1 tabindex="0">Daftar Akun Baru</h1>\n\n          <form id="register-form" class="login-form" role="form">\n            <div class="form-group">\n              <label for="name">Nama Lengkap</label>\n              <input \n                type="text" \n                id="name" \n                name="name" \n                required \n                aria-required="true" \n                placeholder="Masukkan nama lengkap" \n              />\n            </div>\n\n            <div class="form-group">\n              <label for="email">Email</label>\n              <input \n                type="email" \n                id="email" \n                name="email" \n                required \n                aria-required="true" \n                placeholder="Masukkan email aktif" \n              />\n            </div>\n\n            <div class="form-group">\n              <label for="password">Kata Sandi</label>\n              <input \n                type="password" \n                id="password" \n                name="password" \n                required \n                aria-required="true" \n                minlength="8"\n                placeholder="Minimal 8 karakter" \n              />\n            </div>\n\n            <button type="submit" class="login-btn">Daftar</button>\n            <p id="register-message" class="login-message" aria-live="polite"></p>\n          </form>\n\n          <p class="login-switch">\n            Sudah punya akun?\n            <a href="#/login">Masuk di sini</a>\n          </p>\n        </div>\n      </section>\n    ')}),t)}))),function(){return r.apply(this,arguments)})},{key:"afterRender",value:(n=ue(ie().m((function t(){var e,n;return ie().w((function(t){for(;;)switch(t.n){case 0:e=document.getElementById("register-form"),n=new re(this),e.addEventListener("submit",function(){var t=ue(ie().m((function t(e){var r,o,i;return ie().w((function(t){for(;;)switch(t.n){case 0:return e.preventDefault(),r=document.getElementById("name").value.trim(),o=document.getElementById("email").value.trim(),i=document.getElementById("password").value.trim(),t.n=1,n.register({name:r,email:o,password:i});case 1:return t.a(2)}}),t)})));return function(e){return t.apply(this,arguments)}}());case 1:return t.a(2)}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"showMessage",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.getElementById("register-message");n.textContent=t,n.className="login-message ".concat(e?"error":"success")}},{key:"redirectToLogin",value:function(){window.location.hash="#/login"}}],e&&se(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();function pe(t){return pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pe(t)}function de(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return ve(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(ve(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,ve(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,ve(f,"constructor",s),ve(s,"constructor",u),u.displayName="GeneratorFunction",ve(s,o,"GeneratorFunction"),ve(f),ve(f,o,"Generator"),ve(f,r,(function(){return this})),ve(f,"toString",(function(){return"[object Generator]"})),(de=function(){return{w:i,m:p}})()}function ve(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}ve=function(t,e,n,r){function i(e,n){ve(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},ve(t,e,n,r)}function ye(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function me(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){ye(i,r,o,a,c,"next",t)}function c(t){ye(i,r,o,a,c,"throw",t)}a(void 0)}))}}function he(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,be(r.key),r)}}function be(t){var e=function(t){if("object"!=pe(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=pe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==pe(e)?e:e+""}var ge=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"render",value:(r=me(de().m((function t(){return de().w((function(t){for(;;)if(0===t.n)return t.a(2,'\n      <section class="favorite-page">\n        <h1 tabindex="0">üìö Cerita Tersimpan</h1>\n        <div id="favorites-container" class="favorites-list"></div>\n      </section>\n    ')}),t)}))),function(){return r.apply(this,arguments)})},{key:"afterRender",value:(n=me(de().m((function t(){var e,n,r,o,i,a,c,u;return de().w((function(t){for(;;)switch(t.n){case 0:if(e=document.getElementById("favorites-container")){t.n=1;break}return t.a(2);case 1:return n="favorites",o=function(){return new Promise((function(t,e){var o=indexedDB.open("story-favorites-db",1);o.onupgradeneeded=function(t){(r=t.target.result).objectStoreNames.contains(n)||r.createObjectStore(n,{keyPath:"id"})},o.onsuccess=function(e){r=e.target.result,t(r)},o.onerror=function(t){e(t.target.error)}}))},i=function(){return new Promise(function(){var t=me(de().m((function t(e){var r,i,a,c;return de().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,o();case 1:r=t.v,i=r.transaction(n,"readonly"),a=i.objectStore(n),(c=a.getAll()).onsuccess=function(){return e(c.result||[])},c.onerror=function(){return e([])};case 2:return t.a(2)}}),t)})));return function(e){return t.apply(this,arguments)}}())},a=function(){var t=me(de().m((function t(e){var r,i;return de().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,o();case 1:r=t.v,(i=r.transaction(n,"readwrite")).objectStore(n).delete(e),i.oncomplete=function(){return c()};case 2:return t.a(2)}}),t)})));return function(e){return t.apply(this,arguments)}}(),c=function(){var t=me(de().m((function t(){var n;return de().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,i();case 1:if((n=t.v).length){t.n=2;break}return e.innerHTML='\n          <p class="no-favorites" tabindex="0">Belum ada cerita yang disimpan üíæ</p>\n        ',t.a(2);case 2:e.innerHTML=n.map((function(t){return'\n          <article class="favorite-card" tabindex="0" data-id="'.concat(t.id,'">\n            <img \n              src="').concat(t.photoUrl,'" \n              alt="Gambar ').concat(t.name,'" \n              class="favorite-image" \n              loading="lazy"\n            />\n            <h2 tabindex="0">').concat(t.name,"</h2>\n            <p>").concat(t.description,'</p>\n            <p class="story-date">').concat(new Date(t.createdAt).toLocaleString("id-ID"),'</p>\n            <div class="favorite-actions">\n              <button class="view-map" data-lat="').concat(t.lat,'" data-lon="').concat(t.lon,'">üìç Lihat Lokasi</button>\n              <button class="remove-fav" data-id="').concat(t.id,'">üóëÔ∏è Hapus</button>\n            </div>\n          </article>\n        ')})).join(""),u();case 3:return t.a(2)}}),t)})));return function(){return t.apply(this,arguments)}}(),u=function(){document.querySelectorAll(".view-map").forEach((function(t){t.addEventListener("click",(function(){var e=t.dataset.lat,n=t.dataset.lon;e&&n?window.open("https://www.google.com/maps?q=".concat(e,",").concat(n),"_blank"):alert("Lokasi tidak tersedia untuk cerita ini.")}))})),document.querySelectorAll(".remove-fav").forEach((function(t){t.addEventListener("click",me(de().m((function e(){var n;return de().w((function(e){for(;;)switch(e.n){case 0:return n=t.dataset.id,e.n=1,a(n);case 1:return e.a(2)}}),e)}))))}))},t.n=2,c();case 2:return t.a(2)}}),t)}))),function(){return n.apply(this,arguments)})}],e&&he(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();function we(){var t=localStorage.getItem("token"),e=window.location.hash.replace("#","");return!!["/login","/register","/about","/"].includes(e)||!!t||(alert("Anda harus login terlebih dahulu!"),window.location.hash="#/login",!1)}const ke={"/":new K,"/about":new nt,"/add-story":new Gt,"/login":new Qt,"/register":new fe,"/favorite":new ge};function Se(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body;document.startViewTransition?document.startViewTransition((function(){t()})):(t(),function(t){t.style.opacity="0",t.style.transform="translateY(20px)",t.style.transition="opacity 0.3s ease, transform 0.3s ease",requestAnimationFrame((function(){t.style.opacity="1",t.style.transform="translateY(0)"})),setTimeout((function(){t.style.transition=""}),300)}(e))}function je(t){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},je(t)}function Oe(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return Pe(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(Pe(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,Pe(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,Pe(f,"constructor",s),Pe(s,"constructor",u),u.displayName="GeneratorFunction",Pe(s,o,"GeneratorFunction"),Pe(f),Pe(f,o,"Generator"),Pe(f,r,(function(){return this})),Pe(f,"toString",(function(){return"[object Generator]"})),(Oe=function(){return{w:i,m:p}})()}function Pe(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Pe=function(t,e,n,r){function i(e,n){Pe(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Pe(t,e,n,r)}function Ee(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function Te(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Ee(i,r,o,a,c,"next",t)}function c(t){Ee(i,r,o,a,c,"throw",t)}a(void 0)}))}}function _e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ge(r.key),r)}}function Ge(t){var e=function(t){if("object"!=je(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=je(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==je(e)?e:e+""}function Le(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function xe(t,e){return t.get(Fe(t,e))}function Me(t,e,n){return t.set(Fe(t,e),n),n}function Fe(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var Be=new WeakMap,Ie=new WeakMap,Ae=new WeakMap;const Ce=function(){return t=function t(e){var n=e.navigationDrawer,r=e.drawerButton,o=e.content;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Le(this,Be,null),Le(this,Ie,null),Le(this,Ae,null),Me(Be,this,o),Me(Ie,this,r),Me(Ae,this,n),this._setupDrawer(),this._setupAccessibility(),this._updateAuthNav()},e=[{key:"_setupDrawer",value:function(){var t=this;xe(Ie,this).addEventListener("click",(function(){xe(Ae,t).classList.toggle("open")})),xe(Ie,this).addEventListener("keydown",(function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),xe(Ae,t).classList.toggle("open"))})),document.body.addEventListener("click",(function(e){xe(Ae,t).contains(e.target)||xe(Ie,t).contains(e.target)||xe(Ae,t).classList.remove("open"),xe(Ae,t).querySelectorAll("a").forEach((function(n){n.contains(e.target)&&xe(Ae,t).classList.remove("open")}))}))}},{key:"_setupAccessibility",value:function(){var t=this,e=document.querySelector(".skip-link");e&&e.addEventListener("click",(function(t){t.preventDefault();var e=document.querySelector("#main-content");e.setAttribute("tabindex","-1"),e.focus()})),xe(Ae,this).addEventListener("keydown",(function(e){"Escape"===e.key&&(xe(Ae,t).classList.remove("open"),xe(Ie,t).focus())}))}},{key:"renderPage",value:(n=Te(Oe().m((function t(){var e,n,r,o=this;return Oe().w((function(t){for(;;)switch(t.n){case 0:if(c=location.hash.replace("#","")||"/",u=void 0,u=c.split("/"),i={resource:u[1]||null,id:u[2]||null},a=void 0,a="",i.resource&&(a=a.concat("/".concat(i.resource))),i.id&&(a=a.concat("/:id")),n=ke[e=a||"/"],!["/add-story","/favorite"].includes(e)||we()){t.n=1;break}return t.a(2);case 1:if(!n){t.n=4;break}if(!document.startViewTransition){t.n=2;break}document.startViewTransition(Te(Oe().m((function t(){return Oe().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,n.render();case 1:return xe(Be,o).innerHTML=t.v,t.n=2,n.afterRender();case 2:return t.a(2)}}),t)})))),t.n=3;break;case 2:return t.n=3,Se(Te(Oe().m((function t(){return Oe().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,n.render();case 1:return xe(Be,o).innerHTML=t.v,t.n=2,n.afterRender();case 2:return t.a(2)}}),t)}))),xe(Be,this));case 3:(r=xe(Be,this).querySelector("h1"))&&r.hasAttribute("tabindex")&&r.focus(),this._updateAuthNav();case 4:return t.a(2)}var i,a,c,u}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"_updateAuthNav",value:function(){var t=this,e=document.querySelector("#nav-auth");e&&(we()?(e.innerHTML='<button id="logout-btn" class="logout-btn">Logout</button>',document.querySelector("#logout-btn").addEventListener("click",(function(){localStorage.removeItem("token"),window.location.hash="#/login",t._updateAuthNav()}))):e.innerHTML='<a href="#/login">Login</a>')}}],e&&_e(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n}();function Ne(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return De(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(De(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,De(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,De(f,"constructor",s),De(s,"constructor",u),u.displayName="GeneratorFunction",De(s,o,"GeneratorFunction"),De(f),De(f,o,"Generator"),De(f,r,(function(){return this})),De(f,"toString",(function(){return"[object Generator]"})),(Ne=function(){return{w:i,m:p}})()}function De(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}De=function(t,e,n,r){function i(e,n){De(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},De(t,e,n,r)}function qe(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function He(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){qe(i,r,o,a,c,"next",t)}function c(t){qe(i,r,o,a,c,"throw",t)}a(void 0)}))}}const We=function(t){return He(Ne().m((function e(){var n,r,o,i,c;return Ne().w((function(e){for(;;)switch(e.n){case 0:if(n=t.endpoint,r=t.keys,o=a.getToken()){e.n=1;break}throw new Error("Token tidak ditemukan. Silakan login kembali.");case 1:return e.n=2,fetch("https://story-api.dicoding.dev/v1/notifications/subscribe",{method:"POST",headers:{Authorization:"Bearer ".concat(o),"Content-Type":"application/json"},body:JSON.stringify({endpoint:n,keys:r})});case 2:return i=e.v,e.n=3,i.json();case 3:if(c=e.v,i.ok&&!c.error){e.n=4;break}throw new Error(c.message||"Gagal subscribe ke server.");case 4:return e.a(2,c)}}),e)})))()},ze=function(t){return He(Ne().m((function e(){var n,r,o,i;return Ne().w((function(e){for(;;)switch(e.n){case 0:if(n=t.endpoint,r=a.getToken()){e.n=1;break}throw new Error("Token tidak ditemukan.");case 1:return e.n=2,fetch("https://story-api.dicoding.dev/v1/notifications/subscribe",{method:"DELETE",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"},body:JSON.stringify({endpoint:n})});case 2:return o=e.v,e.n=3,o.json();case 3:if(i=e.v,o.ok&&!i.error){e.n=4;break}throw new Error(i.message||"Gagal unsubscribe ke server.");case 4:return e.a(2,i)}}),e)})))()};function Re(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return Ue(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(Ue(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,Ue(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,Ue(f,"constructor",s),Ue(s,"constructor",u),u.displayName="GeneratorFunction",Ue(s,o,"GeneratorFunction"),Ue(f),Ue(f,o,"Generator"),Ue(f,r,(function(){return this})),Ue(f,"toString",(function(){return"[object Generator]"})),(Re=function(){return{w:i,m:p}})()}function Ue(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Ue=function(t,e,n,r){function i(e,n){Ue(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},Ue(t,e,n,r)}function Ve(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function Je(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Ve(i,r,o,a,c,"next",t)}function c(t){Ve(i,r,o,a,c,"throw",t)}a(void 0)}))}}var Ke=document.getElementById("push-toggle"),Ye=!1;function Qe(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),o=0;o<n.length;++o)r[o]=n.charCodeAt(o);return r}function $e(){return Xe.apply(this,arguments)}function Xe(){return(Xe=Je(Re().m((function t(){var e,n,r,o,i,a,c,u;return Re().w((function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,navigator.serviceWorker.ready;case 1:return e=t.v,n=Qe("BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk"),t.n=2,e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n});case 2:return r=t.v,console.log("‚úÖ Push Subscription dibuat:",r),o=r.toJSON(),i=o.endpoint,a=o.keys,t.n=3,We({endpoint:i,keys:a});case 3:c=t.v,console.log("üì° Subscription dikirim ke server:",c),alert("üîî Notifikasi berhasil diaktifkan!"),Ye=!0,en(),t.n=5;break;case 4:t.p=4,u=t.v,console.error("üö´ Gagal subscribe:",u),alert("Gagal mengaktifkan notifikasi. Periksa izin browser.");case 5:return t.a(2)}}),t,null,[[0,4]])})))).apply(this,arguments)}function Ze(){return tn.apply(this,arguments)}function tn(){return(tn=Je(Re().m((function t(){var e,n,r,o;return Re().w((function(t){for(;;)switch(t.p=t.n){case 0:return t.n=1,navigator.serviceWorker.ready;case 1:return e=t.v,t.n=2,e.pushManager.getSubscription();case 2:if(!(n=t.v)){t.n=7;break}return r=n.endpoint,t.p=3,t.n=4,ze({endpoint:r});case 4:return t.n=5,n.unsubscribe();case 5:console.log("üö´ Berhenti langganan notifikasi di server dan browser"),alert("Notifikasi dimatikan."),t.n=7;break;case 6:t.p=6,o=t.v,console.error("Gagal unsubscribe:",o),alert("Terjadi kesalahan saat menonaktifkan notifikasi.");case 7:Ye=!1,en();case 8:return t.a(2)}}),t,null,[[3,6]])})))).apply(this,arguments)}function en(){Ke&&(Ye?(Ke.textContent="üö´ Nonaktifkan Notifikasi",Ke.classList.add("active")):(Ke.textContent="üîî Aktifkan Notifikasi",Ke.classList.remove("active")))}function nn(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return rn(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?rn(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function rn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function on(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return an(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,u=t,p.n=n,a}};function d(n,r){for(c=n,u=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],d=p.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(an(e={},r,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,an(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,an(f,"constructor",s),an(s,"constructor",u),u.displayName="GeneratorFunction",an(s,o,"GeneratorFunction"),an(f),an(f,o,"Generator"),an(f,r,(function(){return this})),an(f,"toString",(function(){return"[object Generator]"})),(on=function(){return{w:i,m:p}})()}function an(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}an=function(t,e,n,r){function i(e,n){an(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},an(t,e,n,r)}function cn(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function un(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){cn(i,r,o,a,c,"next",t)}function c(t){cn(i,r,o,a,c,"throw",t)}a(void 0)}))}}function sn(t){return ln.apply(this,arguments)}function ln(){return(ln=un(on().m((function t(e){var n,r,o;return on().w((function(t){for(;;)switch(t.p=t.n){case 0:return t.n=1,Notification.requestPermission();case 1:if("granted"===t.v){t.n=2;break}return console.log("üö´ Izin notifikasi ditolak oleh user"),t.a(2);case 2:return console.log("üîî Notifikasi diizinkan oleh user"),n=fn("BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk"),t.p=3,t.n=4,e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n});case 4:r=t.v,console.log("‚úÖ Push Subscription berhasil dibuat:",r),t.n=6;break;case 5:t.p=5,o=t.v,console.error("üö´ Gagal membuat Push Subscription:",o);case 6:return t.a(2)}}),t,null,[[3,5]])})))).apply(this,arguments)}function fn(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),o=0;o<n.length;++o)r[o]=n.charCodeAt(o);return r}function pn(){return dn.apply(this,arguments)}function dn(){return(dn=un(on().m((function t(){var e,n,r;return on().w((function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,e=document.getElementById("storyList")){t.n=1;break}return t.a(2);case 1:return t.n=2,bt();case 2:n=t.v,e.querySelectorAll(".story-item.pending").forEach((function(t){return t.remove()})),n.forEach((function(t){var n=document.createElement("div");n.classList.add("story-item","pending"),n.style.opacity="0.7",n.innerHTML="\n        <h3>".concat(t.name," (Offline)</h3>\n        <p>").concat(t.description,"</p>\n        ").concat(t.photo?'<img src="'.concat(t.photo,'" alt="photo" style="width:100%;max-height:200px;object-fit:cover;border-radius:8px;margin-top:8px;" />'):"","\n        <small>‚è≥ Menunggu sinkronisasi...</small>\n      "),e.prepend(n)})),t.n=4;break;case 3:t.p=3,r=t.v,console.error("‚ùå Gagal menampilkan cerita offline:",r);case 4:return t.a(2)}}),t,null,[[0,3]])})))).apply(this,arguments)}function vn(){return yn.apply(this,arguments)}function yn(){return(yn=un(on().m((function t(){var e,n,r,o,i,a,c,u,s,l,f,p,d;return on().w((function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,bt();case 1:if(0!==(e=t.v).length){t.n=2;break}return console.log("‚úÖ Tidak ada cerita pending untuk disinkronkan."),t.a(2);case 2:console.log("üì§ Sinkronisasi ".concat(e.length," cerita...")),n=nn(e),t.p=3,n.s();case 4:if((r=n.n()).done){t.n=15;break}if(o=r.value,t.p=5,(i=new FormData).append("description",o.description),!o.photo){t.n=8;break}return t.n=6,fetch(o.photo);case 6:return a=t.v,t.n=7,a.blob();case 7:c=t.v,i.append("photo",c,"offline-photo.jpg");case 8:return u=localStorage.getItem("authToken"),t.n=9,fetch("https://story-api.dicoding.dev/v1/stories",{method:"POST",headers:{Authorization:"Bearer ".concat(u)},body:i});case 9:return s=t.v,t.n=10,s.json();case 10:if(l=t.v,s.ok){t.n=11;break}throw new Error(l.message);case 11:return console.log('‚úÖ Cerita "'.concat(o.description,'" berhasil disinkronkan.')),t.n=12,wt(o.createdAt);case 12:t.n=14;break;case 13:t.p=13,f=t.v,console.error("üö´ Gagal mengirim cerita:",f);case 14:t.n=4;break;case 15:t.n=17;break;case 16:t.p=16,p=t.v,n.e(p);case 17:return t.p=17,n.f(),t.f(17);case 18:return t.n=19,pn();case 19:t.n=21;break;case 20:t.p=20,d=t.v,console.error("‚ö†Ô∏è Gagal sinkronisasi cerita offline:",d);case 21:return t.a(2)}}),t,null,[[5,13],[3,16,17,18],[0,20]])})))).apply(this,arguments)}"serviceWorker"in navigator||console.error("‚ùå Browser tidak mendukung Service Worker"),"PushManager"in window||console.error("‚ùå Browser tidak mendukung Push API"),Ke&&Ke.addEventListener("click",Je(Re().m((function t(){return Re().w((function(t){for(;;)switch(t.n){case 0:if("denied"!==Notification.permission){t.n=1;break}return alert("Izin notifikasi ditolak. Aktifkan dari pengaturan browser."),t.a(2);case 1:if(!Ye){t.n=3;break}return t.n=2,Ze();case 2:t.n=7;break;case 3:return t.n=4,Notification.requestPermission();case 4:if("granted"!==t.v){t.n=6;break}return t.n=5,$e();case 5:t.n=7;break;case 6:alert("Izin notifikasi tidak diberikan.");case 7:return t.a(2)}}),t)})))),navigator.serviceWorker.ready.then(function(){var t=Je(Re().m((function t(e){var n;return Re().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,e.pushManager.getSubscription();case 1:n=t.v,Ye=!!n,en();case 2:return t.a(2)}}),t)})));return function(e){return t.apply(this,arguments)}}()),document.addEventListener("DOMContentLoaded",un(on().m((function t(){var e,n,r,o,i,a,c,u;return on().w((function(t){for(;;)switch(t.p=t.n){case 0:return e=new Ce({content:document.querySelector("#main-content"),drawerButton:document.querySelector("#drawer-button"),navigationDrawer:document.querySelector("#navigation-drawer")}),t.n=1,e.renderPage();case 1:if(pn(),window.addEventListener("hashchange",un(on().m((function t(){return on().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,e.renderPage();case 1:pn();case 2:return t.a(2)}}),t)})))),!("serviceWorker"in navigator)){t.n=15;break}return t.p=2,n=window.location.pathname.includes("cerita_masyarakat-akhir")?"/cerita_masyarakat-akhir/":"/",r="".concat(n,"sw.js"),t.n=3,navigator.serviceWorker.register(r);case 3:if(o=t.v,console.log("‚úÖ Service Worker terdaftar:",o),o.active){t.n=5;break}return console.log("‚è≥ Menunggu Service Worker aktif..."),t.n=4,new Promise((function(t){o.addEventListener("updatefound",(function(){var e=o.installing;e.addEventListener("statechange",(function(){"activated"===e.state&&(console.log("üî• Service Worker sudah aktif"),t())}))}))}));case 4:t.n=6;break;case 5:console.log("üî• Service Worker sudah aktif");case 6:if(!("SyncManager"in window)){t.n=11;break}return t.p=7,t.n=8,o.sync.register("sync-stories");case 8:console.log("üì° Background Sync: sync-stories terdaftar"),t.n=10;break;case 9:t.p=9,c=t.v,console.error("üö´ Gagal mendaftarkan Background Sync:",c);case 10:t.n=12;break;case 11:console.warn("‚ö†Ô∏è Browser tidak mendukung Background Sync");case 12:return t.n=13,sn(o);case 13:t.n=15;break;case 14:t.p=14,u=t.v,console.error("üö´ Gagal mendaftarkan Service Worker atau Push Notification:",u);case 15:a=document.getElementById("install-btn"),window.addEventListener("beforeinstallprompt",(function(t){t.preventDefault(),i=t,a.hidden=!1,console.log("üì≤ Install prompt tersedia")})),a.addEventListener("click",un(on().m((function t(){var e,n;return on().w((function(t){for(;;)switch(t.n){case 0:if(a.hidden=!0,!i){t.n=2;break}return i.prompt(),t.n=1,i.userChoice;case 1:e=t.v,n=e.outcome,console.log("üí° User memilih: ".concat(n)),i=null;case 2:return t.a(2)}}),t)})))),window.addEventListener("appinstalled",(function(){console.log("‚úÖ Aplikasi telah diinstal"),a.hidden=!0,alert("üéâ Terima kasih! Cerita Masyarakat berhasil diinstal.")})),window.addEventListener("online",un(on().m((function t(){return on().w((function(t){for(;;)switch(t.n){case 0:return console.log("üåê Kembali online, mulai sinkronisasi cerita..."),t.n=1,vn();case 1:return t.a(2)}}),t)}))));case 16:return t.a(2)}}),t,null,[[7,9],[2,14]])}))))})();